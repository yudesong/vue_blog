{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/atom-one-dark.css';\nexport default {\n  name: 'ArticleEditor',\n  props: {\n    article: {\n      type: Object,\n      default: null\n    },\n    categories: {\n      type: Array,\n      required: true\n    }\n  },\n  data() {\n    return {\n      // 代码语言列表\n      codeLanguages: [{\n        value: 'javascript',\n        label: 'JavaScript'\n      }, {\n        value: 'python',\n        label: 'Python'\n      }, {\n        value: 'java',\n        label: 'Java'\n      }, {\n        value: 'cpp',\n        label: 'C++'\n      }, {\n        value: 'c',\n        label: 'C'\n      }, {\n        value: 'csharp',\n        label: 'C#'\n      }, {\n        value: 'php',\n        label: 'PHP'\n      }, {\n        value: 'ruby',\n        label: 'Ruby'\n      }, {\n        value: 'go',\n        label: 'Go'\n      }, {\n        value: 'rust',\n        label: 'Rust'\n      }, {\n        value: 'typescript',\n        label: 'TypeScript'\n      }, {\n        value: 'html',\n        label: 'HTML'\n      }, {\n        value: 'css',\n        label: 'CSS'\n      }, {\n        value: 'json',\n        label: 'JSON'\n      }, {\n        value: 'xml',\n        label: 'XML'\n      }, {\n        value: 'sql',\n        label: 'SQL'\n      }, {\n        value: 'bash',\n        label: 'Bash'\n      }, {\n        value: 'yaml',\n        label: 'YAML'\n      }, {\n        value: 'markdown',\n        label: 'Markdown'\n      }, {\n        value: 'plaintext',\n        label: '纯文本'\n      }],\n      articleForm: {\n        id: null,\n        title: '',\n        category_id: '',\n        // 修改为与watch中一致的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '',\n        status: 'published',\n        publishedDate: '',\n        media: []\n      }\n    };\n  },\n  computed: {\n    isEditing() {\n      return !!this.article;\n    },\n    contentWordCount() {\n      const plainText = this.articleForm.content.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ');\n      return plainText.trim().length;\n    }\n  },\n  watch: {\n    article: {\n      immediate: true,\n      handler(newVal) {\n        if (newVal) {\n          // 根据文章分类名称查找对应的分类ID\n          const categoryId = this.categories.find(c => c.name === newVal.category)?.id || '';\n          this.articleForm = {\n            id: newVal.id,\n            title: newVal.title,\n            category_id: categoryId,\n            tagsStr: newVal.tags.join(','),\n            coverImage: newVal.coverImage,\n            content: newVal.content || '<p></p>',\n            status: 'published',\n            publishedDate: this.formatDateForInput(new Date(newVal.publishedDate)),\n            media: []\n          };\n        } else {\n          this.resetForm();\n        }\n      }\n    },\n    // 监听articleForm.content变化，确保编辑器内容同步\n    'articleForm.content': {\n      handler(newContent) {\n        // 只有当编辑器内容与新内容不同时才更新，避免用户输入时的循环更新\n        if (this.$refs.editorContent && this.$refs.editorContent.innerHTML !== newContent) {\n          this.$nextTick(() => {\n            if (this.$refs.editorContent) {\n              this.$refs.editorContent.innerHTML = newContent;\n              // 应用代码高亮\n              this.applyHighlight();\n            }\n          });\n        }\n      }\n      // 不要设置immediate，避免与mounted中的初始化冲突\n    }\n  },\n  mounted() {\n    if (!this.isEditing) {\n      this.resetForm();\n    } else {\n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content || '<p></p>';\n          // 应用代码高亮\n          this.applyHighlight();\n        }\n      });\n    }\n\n    // 添加粘贴事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.addEventListener('paste', this.handlePaste);\n      // 添加键盘事件监听，特别是删除键\n      this.$refs.editorContent.addEventListener('keydown', this.handleKeydown);\n      // 设置代码变化观察器\n      this.observeCodeChanges();\n    }\n  },\n  beforeUnmount() {\n    // 移除事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.removeEventListener('paste', this.handlePaste);\n      this.$refs.editorContent.removeEventListener('keydown', this.handleKeydown);\n    }\n\n    // 清理mutation observer\n    if (this._codeObserver) {\n      this._codeObserver.disconnect();\n    }\n  },\n  methods: {\n    // 取消编辑\n    cancelEdit() {\n      if (confirm('确定要取消编辑吗？未保存的内容将丢失。')) {\n        this.$emit('cancel');\n      }\n    },\n    resetForm() {\n      this.articleForm = {\n        id: null,\n        title: '',\n        category_id: '',\n        // 确保这里也是正确的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '<p>开始撰写您的文章内容...</p>',\n        status: 'published',\n        publishedDate: this.formatDateForInput(new Date()),\n        media: []\n      };\n\n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content;\n        }\n      });\n    },\n    // 处理粘贴事件\n    async handlePaste(event) {\n      // 阻止默认粘贴行为\n      event.preventDefault();\n      console.log('粘贴事件触发');\n\n      // 获取粘贴的内容\n      const clipboardData = event.clipboardData || window.clipboardData;\n      let html = clipboardData.getData('text/html');\n      if (html) {\n        console.log('检测到HTML内容');\n        // 创建临时DOM元素来处理HTML\n        const tempDiv = document.createElement('div');\n        tempDiv.innerHTML = html;\n\n        // 检查是否包含代码块，如果有，尝试添加语言类\n        const codeBlocks = tempDiv.querySelectorAll('pre code');\n        if (codeBlocks.length > 0) {\n          codeBlocks.forEach(block => {\n            // 如果代码块没有语言类，添加默认的language-plaintext类\n            if (!Array.from(block.classList).some(cls => cls.startsWith('language-'))) {\n              block.classList.add('language-plaintext');\n            }\n          });\n        }\n\n        // 查找所有图片元素\n        const images = tempDiv.querySelectorAll('img');\n        console.log(`找到 ${images.length} 张图片`);\n        if (images.length > 0) {\n          const imagePromises = [];\n\n          // 对每个图片进行处理\n          images.forEach((img, index) => {\n            let src = img.src;\n            // 检查是否有data-src或其他可能的图片源属性\n            if (!src || src === 'about:blank') {\n              src = img.getAttribute('data-src') || img.getAttribute('data-ratio') || img.src;\n            }\n            console.log(`处理图片 ${index + 1}: ${src}`);\n            if (src && !src.startsWith('data:')) {\n              // 为每个图片创建一个Promise\n              const promise = this.convertImageToDataURL(src).then(dataURL => {\n                console.log(`图片 ${index + 1} 转换成功`);\n                // 替换图片src为DataURL\n                img.src = dataURL;\n                img.srcset = ''; // 清空srcset以避免冲突\n                // 移除可能导致问题的属性\n                img.removeAttribute('data-src');\n                img.removeAttribute('data-w');\n                img.removeAttribute('data-ratio');\n                img.removeAttribute('data-type');\n                // 添加适当的样式\n                img.classList.add('max-w-full', 'h-auto');\n                return dataURL;\n              }).catch(error => {\n                console.error(`图片 ${index + 1} 转换失败:`, src, error);\n                // 如果转换失败，尝试更简单的方法\n                try {\n                  // 直接使用fetch获取图片\n                  return fetch(src, {\n                    mode: 'cors',\n                    headers: {\n                      'Access-Control-Allow-Origin': '*'\n                    },\n                    credentials: 'include'\n                  }).then(response => {\n                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n                    return response.blob();\n                  }).then(blob => {\n                    const reader = new FileReader();\n                    return new Promise(resolve => {\n                      reader.onloadend = () => {\n                        const fallbackDataURL = reader.result;\n                        img.src = fallbackDataURL;\n                        console.log(`图片 ${index + 1} 使用备用方法成功`);\n                        resolve(fallbackDataURL);\n                      };\n                      reader.readAsDataURL(blob);\n                    });\n                  }).catch(fallbackError => {\n                    console.error(`图片 ${index + 1} 备用方法也失败:`, fallbackError);\n                    // 最后的选择 - 使用占位图\n                    img.src = 'https://picsum.photos/800/400';\n                    img.alt = '图片加载失败，使用占位图';\n                    return null;\n                  });\n                } catch (e) {\n                  img.src = 'https://picsum.photos/800/400';\n                  return null;\n                }\n              });\n              imagePromises.push(promise);\n            }\n          });\n\n          // 等待所有图片处理完成\n          await Promise.all(imagePromises);\n          console.log('所有图片处理完成');\n        }\n\n        // 获取处理后的HTML\n        const processedHtml = tempDiv.innerHTML;\n        console.log('处理后的HTML内容:', processedHtml.substring(0, 100) + '...');\n\n        // 插入到编辑器\n        this.formatText('insertHTML', processedHtml);\n\n        // 应用代码高亮\n        this.applyHighlight();\n      } else {\n        // 如果没有HTML内容，只粘贴纯文本\n        const text = clipboardData.getData('text/plain');\n        if (text) {\n          console.log('粘贴纯文本内容');\n          this.formatText('insertText', text);\n        }\n      }\n    },\n    // 将图片URL转换为DataURL\n    convertImageToDataURL(url) {\n      return new Promise((resolve, reject) => {\n        // 首先尝试直接fetch获取图片（更可靠的方法）\n        fetch(url, {\n          mode: 'cors',\n          headers: {\n            'Content-Type': 'image/jpeg',\n            'Access-Control-Allow-Origin': '*'\n          },\n          credentials: 'include'\n        }).then(response => {\n          if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n          }\n          return response.blob();\n        }).then(blob => {\n          const reader = new FileReader();\n          reader.onloadend = () => {\n            console.log('使用fetch成功获取图片并转换为DataURL');\n            resolve(reader.result);\n          };\n          reader.onerror = () => {\n            console.error('FileReader读取失败');\n            reject(new Error('读取图片失败'));\n          };\n          reader.readAsDataURL(blob);\n        }).catch(fetchError => {\n          console.warn('fetch方法失败，尝试使用canvas方法:', fetchError);\n\n          // 如果fetch失败，尝试使用canvas方法\n          try {\n            // 创建一个新的图片对象\n            const img = new Image();\n\n            // 设置CORS以允许跨域图片\n            img.crossOrigin = 'anonymous';\n            img.onload = function () {\n              try {\n                // 创建canvas元素\n                const canvas = document.createElement('canvas');\n                canvas.width = this.width || 800;\n                canvas.height = this.height || 600;\n\n                // 绘制图片到canvas\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(this, 0, 0, canvas.width, canvas.height);\n                try {\n                  // 转换为DataURL\n                  const dataURL = canvas.toDataURL('image/jpeg', 0.9);\n                  console.log('使用canvas成功转换图片');\n                  resolve(dataURL);\n                } catch (toDataURLError) {\n                  console.error('canvas toDataURL失败:', toDataURLError);\n                  reject(toDataURLError);\n                }\n              } catch (canvasError) {\n                console.error('canvas处理失败:', canvasError);\n                reject(canvasError);\n              }\n            };\n            img.onerror = function () {\n              console.error('图片加载失败');\n              reject(new Error('图片加载失败'));\n            };\n\n            // 设置超时\n            setTimeout(() => {\n              if (!img.complete) {\n                img.src = '';\n                reject(new Error('图片加载超时'));\n              }\n            }, 10000);\n\n            // 开始加载图片\n            img.src = url;\n          } catch (error) {\n            reject(error);\n          }\n        });\n      });\n    },\n    // 富文本编辑核心方法\n    formatText(command, value = null) {\n      // 先确保编辑器获得焦点\n      if (this.$refs.editorContent) {\n        this.$refs.editorContent.focus();\n\n        // 尝试执行命令\n        try {\n          // 对于formatBlock命令，需要特殊处理\n          if (command === 'formatBlock' && value) {\n            document.execCommand('formatBlock', false, `<${value}>`);\n          } else {\n            document.execCommand(command, false, value);\n          }\n          this.updateContent();\n        } catch (error) {\n          console.error('编辑器命令执行失败:', error);\n        }\n      }\n    },\n    // 插入链接\n    insertLink() {\n      const url = prompt('请输入链接地址:', 'http://');\n      if (url) {\n        this.formatText('createLink', url);\n      }\n    },\n    // 插入视频\n    insertVideo() {\n      const url = prompt('请输入视频地址:', 'http://');\n      if (url) {\n        this.formatText('insertHTML', `<video controls width=\"100%\" src=\"${url}\"></video>`);\n      }\n    },\n    // 插入代码块\n    insertCodeBlock() {\n      // 创建一个临时的div来显示语言选择对话框\n      const dialogContainer = document.createElement('div');\n      dialogContainer.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n      dialogContainer.innerHTML = `\n        <div class=\"bg-white p-4 rounded-lg shadow-lg max-w-md w-full\">\n          <h3 class=\"text-lg font-medium mb-4\">选择编程语言</h3>\n          <select id=\"codeLanguageSelect\" class=\"w-full p-2 border border-gray-300 rounded mb-4\">\n            ${this.codeLanguages.map(lang => `\n              <option value=\"${lang.value}\">${lang.label}</option>\n            `).join('')}\n          </select>\n          <div class=\"flex justify-end space-x-2\">\n            <button id=\"cancelBtn\" class=\"px-4 py-2 border border-gray-300 rounded\">取消</button>\n            <button id=\"confirmBtn\" class=\"px-4 py-2 bg-blue-600 text-white rounded\">确定</button>\n          </div>\n        </div>\n      `;\n      document.body.appendChild(dialogContainer);\n      const select = dialogContainer.querySelector('#codeLanguageSelect');\n      const cancelBtn = dialogContainer.querySelector('#cancelBtn');\n      const confirmBtn = dialogContainer.querySelector('#confirmBtn');\n\n      // 确认按钮点击事件\n      confirmBtn.addEventListener('click', () => {\n        const language = select.value;\n        const languageClass = language === 'plaintext' ? '' : `language-${language}`;\n\n        // 插入代码块\n        this.formatText('insertHTML', `<pre><code class=\"${languageClass}\">在这里输入代码...</code></pre>`);\n\n        // 应用代码高亮\n        this.highlightAllCode();\n\n        // 清理对话框\n        document.body.removeChild(dialogContainer);\n\n        // 尝试聚焦到代码块并选择占位文本\n        setTimeout(() => {\n          const codeElements = this.$refs.editorContent.querySelectorAll('pre code');\n          const lastCode = codeElements[codeElements.length - 1];\n          if (lastCode && lastCode.textContent === '在这里输入代码...') {\n            const range = document.createRange();\n            range.selectNodeContents(lastCode);\n            const selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n          }\n        }, 0);\n      });\n\n      // 取消按钮点击事件\n      cancelBtn.addEventListener('click', () => {\n        document.body.removeChild(dialogContainer);\n      });\n    },\n    // 处理键盘事件，特别是删除键\n    handleKeydown(event) {\n      // 阻止删除键可能导致的页面导航行为\n      if (event.key === 'Backspace' || event.key === 'Delete') {\n        // 阻止默认的页面导航行为\n        event.stopPropagation();\n\n        // 确保编辑器内容区域获得焦点\n        if (this.$refs.editorContent) {\n          // 检查当前选中内容\n          const selection = window.getSelection();\n          if (selection.rangeCount > 0) {\n            const range = selection.getRangeAt(0);\n\n            // 如果删除空内容或光标在开始位置，防止可能的页面跳转\n            if (range.startOffset === 0 && range.endOffset === 0 && range.startContainer.nodeType === 3) {\n              // 如果是文本节点的开头，确保不会触发任何特殊行为\n              const parentElement = range.startContainer.parentNode;\n              if (parentElement && parentElement.previousSibling === null) {\n                // 在顶级元素的开头，确保不会触发任何页面级导航\n                event.preventDefault();\n\n                // 手动处理删除操作\n                if (parentElement.textContent.trim() === '' && parentElement.tagName.toLowerCase() === 'p') {\n                  // 保留空段落，防止编辑器内容完全清空\n                  return;\n                }\n\n                // 恢复默认行为，允许删除\n                setTimeout(() => {\n                  document.execCommand('delete', false, null);\n                  this.updateContent();\n                }, 0);\n              }\n            }\n          }\n        }\n      }\n    },\n    // 应用代码高亮并添加复制按钮\n    highlightAllCode() {\n      if (this.$refs.editorContent) {\n        const codeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n        codeBlocks.forEach(block => {\n          // 先应用高亮\n          this.applyHighlightToBlock(block);\n\n          // 为代码块添加复制按钮\n          this.addCopyButtonToBlock(block);\n        });\n      }\n    },\n    // 只重新高亮代码内容，不重复添加复制按钮\n    rehighlightCodeWithoutButtons() {\n      if (this.$refs.editorContent) {\n        const codeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n        codeBlocks.forEach(block => {\n          this.applyHighlightToBlock(block);\n        });\n      }\n    },\n    // 应用高亮到单个代码块\n    applyHighlightToBlock(block) {\n      // 检查是否需要重新高亮（内容变化时）\n      if (!block.classList.contains('hljs') || this.needsRehighlight(block)) {\n        // 获取语言类\n        const languageClass = Array.from(block.classList).find(cls => cls.startsWith('language-'));\n        if (languageClass) {\n          const language = languageClass.replace('language-', '');\n          // 尝试使用指定语言高亮\n          if (hljs.getLanguage(language)) {\n            hljs.highlightElement(block);\n          } else {\n            // 如果指定的语言不可用，自动检测\n            hljs.highlightElement(block);\n          }\n        } else {\n          // 自动检测语言\n          hljs.highlightElement(block);\n        }\n      }\n    },\n    // 判断代码块是否需要重新高亮\n    needsRehighlight(block) {\n      // 简单判断：如果代码块的子节点只有文本节点，可能需要重新高亮\n      // 或者我们可以添加一个时间戳标记上次高亮时间\n      return Array.from(block.childNodes).some(node => node.nodeType === 3);\n    },\n    // 为代码块添加复制按钮\n    addCopyButtonToBlock(block) {\n      const preElement = block.parentElement;\n      // 检查是否已经有复制按钮，避免重复添加\n      if (preElement && !preElement.querySelector('.copy-button')) {\n        // 创建复制按钮\n        const copyButton = document.createElement('button');\n        copyButton.className = 'copy-button';\n        copyButton.innerHTML = '<i class=\"fa fa-copy\"></i>';\n        copyButton.title = '复制代码';\n        copyButton.addEventListener('click', e => {\n          e.stopPropagation();\n          this.copyCode(block.textContent);\n          // 临时更改按钮文本为\"已复制\"\n          const originalText = copyButton.innerHTML;\n          copyButton.innerHTML = '<i class=\"fa fa-check\"></i>';\n          setTimeout(() => {\n            copyButton.innerHTML = originalText;\n          }, 2000);\n        });\n\n        // 确保pre元素有相对定位\n        if (window.getComputedStyle(preElement).position === 'static') {\n          preElement.style.position = 'relative';\n        }\n\n        // 添加按钮到pre元素\n        preElement.appendChild(copyButton);\n      }\n    },\n    // 复制代码功能\n    copyCode(text) {\n      navigator.clipboard.writeText(text).then(() => {\n        // 可以添加复制成功的提示\n        this.showNotification('代码已复制到剪贴板');\n      }).catch(err => {\n        console.error('复制失败:', err);\n      });\n    },\n    // 显示通知提示\n    showNotification(message) {\n      // 创建通知元素\n      const notification = document.createElement('div');\n      notification.className = 'code-copy-notification';\n      notification.textContent = message;\n\n      // 添加到文档\n      document.body.appendChild(notification);\n\n      // 3秒后移除\n      setTimeout(() => {\n        notification.classList.add('fade-out');\n        setTimeout(() => {\n          document.body.removeChild(notification);\n        }, 300);\n      }, 2000);\n    },\n    // 监听代码块变化并重新高亮\n    observeCodeChanges() {\n      if (this.$refs.editorContent) {\n        const observer = new MutationObserver(mutations => {\n          let needsHighlight = false;\n          mutations.forEach(mutation => {\n            // 检查是否有代码块被修改或添加\n            const relevantChange = Array.from(mutation.addedNodes).some(node => {\n              if (node.nodeType === 1) {\n                // 检查是否是pre元素或包含pre code的元素\n                return node.tagName === 'PRE' || node.querySelector && node.querySelector('pre code') || node.parentElement && node.parentElement.tagName === 'PRE' && node.tagName === 'CODE';\n              }\n              return false;\n            });\n\n            // 检查文本内容变化，可能是代码内容修改\n            const textChangeInCode = mutation.type === 'characterData' && mutation.target.parentElement && mutation.target.parentElement.tagName === 'CODE' && mutation.target.parentElement.parentElement && mutation.target.parentElement.parentElement.tagName === 'PRE';\n            if (relevantChange || textChangeInCode) {\n              needsHighlight = true;\n            }\n          });\n          if (needsHighlight) {\n            // 延迟执行以确保DOM完全更新\n            setTimeout(() => {\n              // 只重新高亮内容，不重复添加复制按钮\n              this.rehighlightCodeWithoutButtons();\n            }, 0);\n          }\n        });\n        observer.observe(this.$refs.editorContent, {\n          childList: true,\n          subtree: true,\n          characterData: true\n        });\n\n        // 保存observer引用以便在组件销毁时清理\n        this._codeObserver = observer;\n      }\n    },\n    // 手动应用代码高亮（用于粘贴或内容加载后）\n    applyHighlight() {\n      // 只重新高亮代码内容，不添加复制按钮\n      setTimeout(() => this.rehighlightCodeWithoutButtons(), 0);\n    },\n    formatDateForInput(date) {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    },\n    updateContent() {\n      if (this.$refs.editorContent) {\n        // 保存当前光标位置\n        const selection = window.getSelection();\n        const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n\n        // 获取当前的代码块数量，用于后续检查是否有新的代码块被添加\n        const currentCodeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n        const currentBlockCount = currentCodeBlocks.length;\n\n        // 更新内容\n        this.articleForm.content = this.$refs.editorContent.innerHTML;\n\n        // 先应用代码高亮\n        this.applyHighlight();\n\n        // 检查是否有新的代码块被添加，如果有，则为新代码块添加复制按钮\n        setTimeout(() => {\n          const updatedCodeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n          if (updatedCodeBlocks.length > currentBlockCount) {\n            // 只为新添加的代码块添加复制按钮\n            const newBlocks = Array.from(updatedCodeBlocks).slice(currentBlockCount);\n            newBlocks.forEach(block => {\n              this.addCopyButtonToBlock(block);\n            });\n          }\n        }, 10);\n\n        // 恢复光标位置（如果之前有有效光标位置）\n        setTimeout(() => {\n          if (range && selection) {\n            try {\n              selection.removeAllRanges();\n              selection.addRange(range);\n            } catch (e) {\n              // 忽略无法恢复光标的情况\n            }\n          }\n        }, 0);\n      }\n    },\n    // 触发特色图片上传\n    triggerImageUpload() {\n      this.$refs.imageUpload.click();\n    },\n    // 触发内容中插入图片\n    triggerImageInsert() {\n      this.$refs.imageInsert.click();\n    },\n    // 处理特色图片上传\n    handleCoverImageUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 这里只是模拟上传，实际项目中应该发送到服务器\n        const reader = new FileReader();\n        reader.onload = event => {\n          this.articleForm.coverImage = event.target.result;\n        };\n        reader.readAsDataURL(file);\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = '';\n    },\n    // 处理内容图片上传\n    handleImageUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 模拟上传\n        const reader = new FileReader();\n        reader.onload = event => {\n          // 将图片添加到媒体列表\n          this.articleForm.media.push({\n            id: Date.now(),\n            type: 'image',\n            url: event.target.result,\n            name: file.name\n          });\n\n          // 同时在编辑器中插入图片\n          if (this.$refs.editorContent) {\n            this.$refs.editorContent.focus();\n            this.formatText('insertHTML', `<img src=\"${event.target.result}\" alt=\"${file.name}\" class=\"max-w-full h-auto\">`);\n          }\n        };\n        reader.readAsDataURL(file);\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = '';\n    },\n    // 处理视频上传\n    handleVideoUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'video',\n          url: '#',\n          name: file.name\n        });\n      }\n      e.target.value = '';\n    },\n    // 处理音频上传\n    handleAudioUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'audio',\n          url: '#',\n          name: file.name\n        });\n      }\n      e.target.value = '';\n    },\n    // 移除媒体\n    removeMedia(id) {\n      this.articleForm.media = this.articleForm.media.filter(media => media.id !== id);\n    },\n    // 简化版保存草稿方法\n    saveAsDraft() {\n      console.log('开始保存草稿');\n\n      // 简化验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题');\n        return;\n      }\n\n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'draft',\n        publishedDate: this.articleForm.publishedDate,\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      };\n      console.log('发出save事件（草稿）:', submitData);\n\n      // 直接使用this.$emit\n      this.$emit('save', submitData);\n      console.log('save事件已发出');\n      alert('文章已保存为草稿');\n    },\n    // 简化版发布/更新方法\n    publishArticle() {\n      console.log('开始发布/更新文章');\n\n      // 完整验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题');\n        return;\n      }\n      if (!this.articleForm.category_id) {\n        alert('请选择文章分类');\n        return;\n      }\n      if (!this.articleForm.content.trim() || this.articleForm.content === '<p>开始撰写您的文章内容...</p>') {\n        alert('请输入文章内容');\n        return;\n      }\n\n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'published',\n        publishedDate: new Date().toISOString(),\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      };\n      console.log('发出save事件（发布）:', submitData);\n\n      // 直接使用this.$emit\n      this.$emit('save', submitData);\n      console.log('save事件已发出');\n      alert('文章已成功' + (this.isEditing ? '更新' : '发布'));\n    },\n    // 更新文章\n    async updateArticle() {\n      if (!this.articleForm.id) {\n        alert('请先编辑文章');\n        return;\n      }\n\n      // 转换标签字符串为数组\n      this.articleForm.tags = this.articleForm.tagsStr.split(',').map(tag => tag.trim());\n      // 发送PUT请求更新文章\n      try {\n        const url = `http://localhost:5000/api/articles/${this.articleForm.id}`;\n        const response = await fetch(url, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(this.articleForm)\n        });\n        if (!response.ok) {\n          throw new Error('Failed to update article');\n        }\n\n        // 重置表单\n        this.showArticleEditor = false;\n      } catch (error) {\n        console.error('Error updating article:', error);\n        alert('更新文章失败，请稍后重试');\n      }\n    }\n  }\n};","map":{"version":3,"names":["hljs","name","props","article","type","Object","default","categories","Array","required","data","codeLanguages","value","label","articleForm","id","title","category_id","tagsStr","coverImage","content","status","publishedDate","media","computed","isEditing","contentWordCount","plainText","replace","trim","length","watch","immediate","handler","newVal","categoryId","find","c","category","tags","join","formatDateForInput","Date","resetForm","newContent","$refs","editorContent","innerHTML","$nextTick","applyHighlight","mounted","addEventListener","handlePaste","handleKeydown","observeCodeChanges","beforeUnmount","removeEventListener","_codeObserver","disconnect","methods","cancelEdit","confirm","$emit","event","preventDefault","console","log","clipboardData","window","html","getData","tempDiv","document","createElement","codeBlocks","querySelectorAll","forEach","block","from","classList","some","cls","startsWith","add","images","imagePromises","img","index","src","getAttribute","promise","convertImageToDataURL","then","dataURL","srcset","removeAttribute","catch","error","fetch","mode","headers","credentials","response","ok","Error","blob","reader","FileReader","Promise","resolve","onloadend","fallbackDataURL","result","readAsDataURL","fallbackError","alt","e","push","all","processedHtml","substring","formatText","text","url","reject","onerror","fetchError","warn","Image","crossOrigin","onload","canvas","width","height","ctx","getContext","drawImage","toDataURL","toDataURLError","canvasError","setTimeout","complete","command","focus","execCommand","updateContent","insertLink","prompt","insertVideo","insertCodeBlock","dialogContainer","className","map","lang","body","appendChild","select","querySelector","cancelBtn","confirmBtn","language","languageClass","highlightAllCode","removeChild","codeElements","lastCode","textContent","range","createRange","selectNodeContents","selection","getSelection","removeAllRanges","addRange","key","stopPropagation","rangeCount","getRangeAt","startOffset","endOffset","startContainer","nodeType","parentElement","parentNode","previousSibling","tagName","toLowerCase","applyHighlightToBlock","addCopyButtonToBlock","rehighlightCodeWithoutButtons","contains","needsRehighlight","getLanguage","highlightElement","childNodes","node","preElement","copyButton","copyCode","originalText","getComputedStyle","position","style","navigator","clipboard","writeText","showNotification","err","message","notification","observer","MutationObserver","mutations","needsHighlight","mutation","relevantChange","addedNodes","textChangeInCode","target","observe","childList","subtree","characterData","date","year","getFullYear","month","String","getMonth","padStart","day","getDate","currentCodeBlocks","currentBlockCount","updatedCodeBlocks","newBlocks","slice","triggerImageUpload","imageUpload","click","triggerImageInsert","imageInsert","handleCoverImageUpload","file","files","handleImageUpload","now","handleVideoUpload","handleAudioUpload","removeMedia","filter","saveAsDraft","alert","submitData","split","tag","publishArticle","toISOString","updateArticle","method","JSON","stringify","showArticleEditor"],"sources":["/Users/yudesong/Project/Vue/blog/src/components/ArticleEditor.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <div class=\"max-w-5xl mx-auto p-4 bg-white min-h-screen\">\n      <!-- 模态框头部 -->\n      <div class=\"flex justify-between items-center p-4 border-b border-gray-200\">\n        <h3 class=\"text-lg font-medium text-gray-800\">{{ isEditing ? '编辑文章' : '新建文章' }}</h3>\n        <div class=\"flex space-x-2\">\n          <button \n            class=\"px-3 py-1 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors\"\n            @click=\"$emit('close')\"\n          >\n            取消\n          </button>\n          <button \n            class=\"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors\"\n            @click=\"saveArticle\"\n          >\n            保存\n          </button>\n        </div>\n      </div>\n      \n      <!-- 模态框内容 -->\n      <div class=\"flex-1 overflow-y-auto p-4\">\n        <!-- 文章基本信息 -->\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n          <div class=\"md:col-span-2\">\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">文章标题</label>\n            <input \n              v-model=\"articleForm.title\"\n              type=\"text\" \n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"请输入文章标题\"\n              maxlength=\"100\"\n            />\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">文章分类</label>\n            <select \n              v-model=\"articleForm.category_id\"\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"\">请选择分类</option>\n              <option v-for=\"category in categories\" :key=\"category.id\" :value=\"category.id\">\n                {{ category.name }}\n              </option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">文章标签</label>\n            <input \n              v-model=\"articleForm.tagsStr\"\n              type=\"text\" \n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"多个标签用逗号分隔\"\n            />\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">发布日期</label>\n            <input \n              v-model=\"articleForm.publishedDate\"\n              type=\"date\" \n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n        \n        <!-- 特色图片 -->\n        <div class=\"mb-6\">\n          <label class=\"block text-sm font-medium text-gray-700 mb-2\">特色图片</label>\n          <div class=\"flex items-center space-x-4\">\n            <div v-if=\"articleForm.coverImage\" class=\"w-32 h-20 rounded overflow-hidden border border-gray-200\">\n              <img :src=\"articleForm.coverImage\" alt=\"封面图片\" class=\"w-full h-full object-cover\" />\n            </div>\n            <button \n              class=\"px-3 py-1 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center\"\n              @click=\"triggerImageUpload\"\n            >\n              <i class=\"fa fa-upload mr-1\"></i>\n              上传图片\n            </button>\n            <input \n              ref=\"imageUpload\"\n              type=\"file\" \n              accept=\"image/*\"\n              class=\"hidden\"\n              @change=\"handleCoverImageUpload\"\n            />\n          </div>\n        </div>\n        \n        <!-- 文章内容编辑器 -->\n        <div class=\"mb-6\">\n          <label class=\"block text-sm font-medium text-gray-700 mb-2\">文章内容</label>\n          \n          <!-- 编辑器工具栏 -->\n          <div class=\"border border-gray-300 rounded-t-lg p-2 bg-gray-50 flex flex-wrap gap-1\">\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"加粗\" @click=\"formatText('bold')\"><i class=\"fa fa-bold\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"斜体\" @click=\"formatText('italic')\"><i class=\"fa fa-italic\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"下划线\" @click=\"formatText('underline')\"><i class=\"fa fa-underline\"></i></button>\n            <span class=\"border-r border-gray-300 h-6 mx-1\"></span>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"H2标题\" @click=\"formatText('formatBlock', 'h2')\"><i class=\"fa fa-header\"></i>H2</button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"H3标题\" @click=\"formatText('formatBlock', 'h3')\"><i class=\"fa fa-header\"></i>H3</button>\n            <span class=\"border-r border-gray-300 h-6 mx-1\"></span>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"无序列表\" @click=\"formatText('insertUnorderedList')\"><i class=\"fa fa-list-ul\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"有序列表\" @click=\"formatText('insertOrderedList')\"><i class=\"fa fa-list-ol\"></i></button>\n            <span class=\"border-r border-gray-300 h-6 mx-1\"></span>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入链接\" @click=\"insertLink\"><i class=\"fa fa-link\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入图片\" @click=\"triggerImageInsert\"><i class=\"fa fa-image\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入视频\" @click=\"insertVideo\"><i class=\"fa fa-video\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入代码块\" @click=\"insertCodeBlock\"><i class=\"fa fa-code\"></i></button>\n          </div>\n          \n          <!-- 编辑器内容区 -->\n          <div \n            ref=\"editorContent\"\n            contenteditable=\"true\"\n            class=\"border border-gray-300 border-t-0 rounded-b-lg p-4 min-h-[300px] focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            @input=\"updateContent\"\n          ></div>\n        </div>\n        \n        <!-- 媒体上传区域 -->\n        <div class=\"mb-4\" v-if=\"articleForm.media.length > 0\">\n          <label class=\"block text-sm font-medium text-gray-700 mb-2\">上传的媒体</label>\n          <div class=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\n            <div v-for=\"media in articleForm.media\" :key=\"media.id\" class=\"relative\">\n              <div class=\"bg-gray-100 rounded p-2 flex flex-col items-center justify-center\">\n                <i v-if=\"media.type === 'video'\" class=\"fa fa-video text-gray-500 text-2xl mb-1\"></i>\n                <i v-else-if=\"media.type === 'audio'\" class=\"fa fa-music text-gray-500 text-2xl mb-1\"></i>\n                <img v-else :src=\"media.url\" alt=\"媒体预览\" class=\"w-full h-20 object-cover rounded mb-1\" />\n                <div class=\"text-xs text-gray-500 truncate text-center\">{{ media.name }}</div>\n              </div>\n              <button \n                class=\"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors\"\n                @click=\"removeMedia(media.id)\"\n              >\n                <i class=\"fa fa-times text-xs\"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 页面底部操作区 -->\n      <div class=\"fixed bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-white shadow-lg\">\n        <div class=\"max-w-5xl mx-auto flex justify-between items-center\">\n          <div class=\"text-sm text-gray-500\">\n            字数统计：{{ contentWordCount }}\n          </div>\n          <div>\n            <button \n              class=\"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-100 mr-2 transition-colors\"\n              @click=\"cancelEdit\"\n            >\n              取消\n            </button>\n            <button \n              class=\"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-100 mr-2 transition-colors\"\n              @click=\"saveAsDraft\"\n            >\n              保存为草稿\n            </button>\n            <button \n              class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n              @click=\"publishArticle\"\n            >\n              {{ isEditing ? '更新文章' : '发布文章' }}\n            </button>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 隐藏的文件上传输入 -->\n      <input \n        ref=\"imageInsert\"\n        type=\"file\" \n        accept=\"image/*\"\n        class=\"hidden\"\n        @change=\"handleImageUpload\"\n      />\n      <input \n        ref=\"videoUpload\"\n        type=\"file\" \n        accept=\"video/*\"\n        class=\"hidden\"\n        @change=\"handleVideoUpload\"\n      />\n      <input \n        ref=\"audioUpload\"\n        type=\"file\" \n        accept=\"audio/*\"\n        class=\"hidden\"\n        @change=\"handleAudioUpload\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/atom-one-dark.css';\n\nexport default {\n  name: 'ArticleEditor',\n  props: {\n    article: {\n      type: Object,\n      default: null\n    },\n    categories: {\n      type: Array,\n      required: true\n    }\n  },\n  data() {\n    return {\n      // 代码语言列表\n      codeLanguages: [\n        { value: 'javascript', label: 'JavaScript' },\n        { value: 'python', label: 'Python' },\n        { value: 'java', label: 'Java' },\n        { value: 'cpp', label: 'C++' },\n        { value: 'c', label: 'C' },\n        { value: 'csharp', label: 'C#' },\n        { value: 'php', label: 'PHP' },\n        { value: 'ruby', label: 'Ruby' },\n        { value: 'go', label: 'Go' },\n        { value: 'rust', label: 'Rust' },\n        { value: 'typescript', label: 'TypeScript' },\n        { value: 'html', label: 'HTML' },\n        { value: 'css', label: 'CSS' },\n        { value: 'json', label: 'JSON' },\n        { value: 'xml', label: 'XML' },\n        { value: 'sql', label: 'SQL' },\n        { value: 'bash', label: 'Bash' },\n        { value: 'yaml', label: 'YAML' },\n        { value: 'markdown', label: 'Markdown' },\n        { value: 'plaintext', label: '纯文本' }\n      ],\n      articleForm: {\n        id: null,\n        title: '',\n        category_id: '', // 修改为与watch中一致的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '',\n        status: 'published',\n        publishedDate: '',\n        media: []\n      }\n    }\n  },\n  computed: {\n    isEditing() {\n      return !!this.article\n    },\n    contentWordCount() {\n      const plainText = this.articleForm.content.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ')\n      return plainText.trim().length\n    }\n  },\n    watch: {\n      article: {\n        immediate: true,\n        handler(newVal) {\n          if (newVal) {\n            // 根据文章分类名称查找对应的分类ID\n            const categoryId = this.categories.find(c => c.name === newVal.category)?.id || '';\n            \n            this.articleForm = {\n              id: newVal.id,\n              title: newVal.title,\n              category_id: categoryId,\n              tagsStr: newVal.tags.join(','),\n              coverImage: newVal.coverImage,\n              content: newVal.content || '<p></p>',\n              status: 'published',\n              publishedDate: this.formatDateForInput(new Date(newVal.publishedDate)),\n              media: []\n            }\n          } else {\n            this.resetForm()\n          }\n        }\n      },\n      // 监听articleForm.content变化，确保编辑器内容同步\n      'articleForm.content': {\n        handler(newContent) {\n          // 只有当编辑器内容与新内容不同时才更新，避免用户输入时的循环更新\n          if (this.$refs.editorContent && this.$refs.editorContent.innerHTML !== newContent) {\n            this.$nextTick(() => {\n              if (this.$refs.editorContent) {\n                this.$refs.editorContent.innerHTML = newContent;\n                // 应用代码高亮\n                this.applyHighlight();\n              }\n            });\n          }\n        },\n        // 不要设置immediate，避免与mounted中的初始化冲突\n      }\n    },\n  mounted() {\n    if (!this.isEditing) {\n      this.resetForm()\n    } else {\n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content || '<p></p>';\n          // 应用代码高亮\n          this.applyHighlight();\n        }\n      })\n    }\n    \n    // 添加粘贴事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.addEventListener('paste', this.handlePaste);\n      // 添加键盘事件监听，特别是删除键\n      this.$refs.editorContent.addEventListener('keydown', this.handleKeydown);\n      // 设置代码变化观察器\n      this.observeCodeChanges();\n    }\n  },\n  \n  beforeUnmount() {\n    // 移除事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.removeEventListener('paste', this.handlePaste);\n      this.$refs.editorContent.removeEventListener('keydown', this.handleKeydown);\n    }\n    \n    // 清理mutation observer\n    if (this._codeObserver) {\n      this._codeObserver.disconnect();\n    }\n  },\n  methods: {\n    // 取消编辑\n    cancelEdit() {\n      if (confirm('确定要取消编辑吗？未保存的内容将丢失。')) {\n        this.$emit('cancel')\n      }\n    },\n    \n    resetForm() {\n      this.articleForm = {\n        id: null,\n        title: '',\n        category_id: '', // 确保这里也是正确的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '<p>开始撰写您的文章内容...</p>',\n        status: 'published',\n        publishedDate: this.formatDateForInput(new Date()),\n        media: []\n      }\n      \n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content;\n        }\n      });\n    },\n    \n    // 处理粘贴事件\n    async handlePaste(event) {\n      // 阻止默认粘贴行为\n      event.preventDefault();\n      \n      console.log('粘贴事件触发');\n      \n      // 获取粘贴的内容\n      const clipboardData = event.clipboardData || window.clipboardData;\n      let html = clipboardData.getData('text/html');\n      \n      if (html) {\n        console.log('检测到HTML内容');\n        // 创建临时DOM元素来处理HTML\n        const tempDiv = document.createElement('div');\n        tempDiv.innerHTML = html;\n        \n        // 检查是否包含代码块，如果有，尝试添加语言类\n        const codeBlocks = tempDiv.querySelectorAll('pre code');\n        if (codeBlocks.length > 0) {\n          codeBlocks.forEach(block => {\n            // 如果代码块没有语言类，添加默认的language-plaintext类\n            if (!Array.from(block.classList).some(cls => cls.startsWith('language-'))) {\n              block.classList.add('language-plaintext');\n            }\n          });\n        }\n        \n        // 查找所有图片元素\n        const images = tempDiv.querySelectorAll('img');\n        console.log(`找到 ${images.length} 张图片`);\n        \n        if (images.length > 0) {\n          const imagePromises = [];\n          \n          // 对每个图片进行处理\n          images.forEach((img, index) => {\n            let src = img.src;\n            // 检查是否有data-src或其他可能的图片源属性\n            if (!src || src === 'about:blank') {\n              src = img.getAttribute('data-src') || img.getAttribute('data-ratio') || img.src;\n            }\n            \n            console.log(`处理图片 ${index + 1}: ${src}`);\n            \n            if (src && !src.startsWith('data:')) {\n              // 为每个图片创建一个Promise\n              const promise = this.convertImageToDataURL(src).then(dataURL => {\n                console.log(`图片 ${index + 1} 转换成功`);\n                // 替换图片src为DataURL\n                img.src = dataURL;\n                img.srcset = ''; // 清空srcset以避免冲突\n                // 移除可能导致问题的属性\n                img.removeAttribute('data-src');\n                img.removeAttribute('data-w');\n                img.removeAttribute('data-ratio');\n                img.removeAttribute('data-type');\n                // 添加适当的样式\n                img.classList.add('max-w-full', 'h-auto');\n                return dataURL;\n              }).catch(error => {\n                console.error(`图片 ${index + 1} 转换失败:`, src, error);\n                // 如果转换失败，尝试更简单的方法\n                try {\n                  // 直接使用fetch获取图片\n                  return fetch(src, {\n                    mode: 'cors',\n                    headers: {\n                      'Access-Control-Allow-Origin': '*'\n                    },\n                    credentials: 'include'\n                  })\n                  .then(response => {\n                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n                    return response.blob();\n                  })\n                  .then(blob => {\n                    const reader = new FileReader();\n                    return new Promise((resolve) => {\n                      reader.onloadend = () => {\n                        const fallbackDataURL = reader.result;\n                        img.src = fallbackDataURL;\n                        console.log(`图片 ${index + 1} 使用备用方法成功`);\n                        resolve(fallbackDataURL);\n                      };\n                      reader.readAsDataURL(blob);\n                    });\n                  })\n                  .catch(fallbackError => {\n                    console.error(`图片 ${index + 1} 备用方法也失败:`, fallbackError);\n                    // 最后的选择 - 使用占位图\n                    img.src = 'https://picsum.photos/800/400';\n                    img.alt = '图片加载失败，使用占位图';\n                    return null;\n                  });\n                } catch (e) {\n                  img.src = 'https://picsum.photos/800/400';\n                  return null;\n                }\n              });\n              imagePromises.push(promise);\n            }\n          });\n          \n          // 等待所有图片处理完成\n          await Promise.all(imagePromises);\n          console.log('所有图片处理完成');\n        }\n        \n        // 获取处理后的HTML\n        const processedHtml = tempDiv.innerHTML;\n        console.log('处理后的HTML内容:', processedHtml.substring(0, 100) + '...');\n        \n        // 插入到编辑器\n        this.formatText('insertHTML', processedHtml);\n        \n        // 应用代码高亮\n        this.applyHighlight();\n      } else {\n        // 如果没有HTML内容，只粘贴纯文本\n        const text = clipboardData.getData('text/plain');\n        if (text) {\n          console.log('粘贴纯文本内容');\n          this.formatText('insertText', text);\n        }\n      }\n    },\n    \n    // 将图片URL转换为DataURL\n    convertImageToDataURL(url) {\n      return new Promise((resolve, reject) => {\n        // 首先尝试直接fetch获取图片（更可靠的方法）\n        fetch(url, {\n          mode: 'cors',\n          headers: {\n            'Content-Type': 'image/jpeg',\n            'Access-Control-Allow-Origin': '*'\n          },\n          credentials: 'include'\n        })\n        .then(response => {\n          if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n          }\n          return response.blob();\n        })\n        .then(blob => {\n          const reader = new FileReader();\n          reader.onloadend = () => {\n            console.log('使用fetch成功获取图片并转换为DataURL');\n            resolve(reader.result);\n          };\n          reader.onerror = () => {\n            console.error('FileReader读取失败');\n            reject(new Error('读取图片失败'));\n          };\n          reader.readAsDataURL(blob);\n        })\n        .catch(fetchError => {\n          console.warn('fetch方法失败，尝试使用canvas方法:', fetchError);\n          \n          // 如果fetch失败，尝试使用canvas方法\n          try {\n            // 创建一个新的图片对象\n            const img = new Image();\n            \n            // 设置CORS以允许跨域图片\n            img.crossOrigin = 'anonymous';\n            \n            img.onload = function() {\n              try {\n                // 创建canvas元素\n                const canvas = document.createElement('canvas');\n                canvas.width = this.width || 800;\n                canvas.height = this.height || 600;\n                \n                // 绘制图片到canvas\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(this, 0, 0, canvas.width, canvas.height);\n                \n                try {\n                  // 转换为DataURL\n                  const dataURL = canvas.toDataURL('image/jpeg', 0.9);\n                  console.log('使用canvas成功转换图片');\n                  resolve(dataURL);\n                } catch (toDataURLError) {\n                  console.error('canvas toDataURL失败:', toDataURLError);\n                  reject(toDataURLError);\n                }\n              } catch (canvasError) {\n                console.error('canvas处理失败:', canvasError);\n                reject(canvasError);\n              }\n            };\n            \n            img.onerror = function() {\n              console.error('图片加载失败');\n              reject(new Error('图片加载失败'));\n            };\n            \n            // 设置超时\n            setTimeout(() => {\n              if (!img.complete) {\n                img.src = '';\n                reject(new Error('图片加载超时'));\n              }\n            }, 10000);\n            \n            // 开始加载图片\n            img.src = url;\n          } catch (error) {\n            reject(error);\n          }\n        });\n      });\n    },\n    \n    // 富文本编辑核心方法\n    formatText(command, value = null) {\n      // 先确保编辑器获得焦点\n      if (this.$refs.editorContent) {\n        this.$refs.editorContent.focus();\n        \n        // 尝试执行命令\n        try {\n          // 对于formatBlock命令，需要特殊处理\n          if (command === 'formatBlock' && value) {\n            document.execCommand('formatBlock', false, `<${value}>`);\n          } else {\n            document.execCommand(command, false, value);\n          }\n          this.updateContent();\n        } catch (error) {\n          console.error('编辑器命令执行失败:', error);\n        }\n      }\n    },\n    \n    // 插入链接\n    insertLink() {\n      const url = prompt('请输入链接地址:', 'http://');\n      if (url) {\n        this.formatText('createLink', url);\n      }\n    },\n    \n    // 插入视频\n    insertVideo() {\n      const url = prompt('请输入视频地址:', 'http://');\n      if (url) {\n        this.formatText('insertHTML', `<video controls width=\"100%\" src=\"${url}\"></video>`);\n      }\n    },\n    \n    // 插入代码块\n    insertCodeBlock() {\n      // 创建一个临时的div来显示语言选择对话框\n      const dialogContainer = document.createElement('div');\n      dialogContainer.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n      dialogContainer.innerHTML = `\n        <div class=\"bg-white p-4 rounded-lg shadow-lg max-w-md w-full\">\n          <h3 class=\"text-lg font-medium mb-4\">选择编程语言</h3>\n          <select id=\"codeLanguageSelect\" class=\"w-full p-2 border border-gray-300 rounded mb-4\">\n            ${this.codeLanguages.map(lang => `\n              <option value=\"${lang.value}\">${lang.label}</option>\n            `).join('')}\n          </select>\n          <div class=\"flex justify-end space-x-2\">\n            <button id=\"cancelBtn\" class=\"px-4 py-2 border border-gray-300 rounded\">取消</button>\n            <button id=\"confirmBtn\" class=\"px-4 py-2 bg-blue-600 text-white rounded\">确定</button>\n          </div>\n        </div>\n      `;\n      \n      document.body.appendChild(dialogContainer);\n      \n      const select = dialogContainer.querySelector('#codeLanguageSelect');\n      const cancelBtn = dialogContainer.querySelector('#cancelBtn');\n      const confirmBtn = dialogContainer.querySelector('#confirmBtn');\n      \n      // 确认按钮点击事件\n      confirmBtn.addEventListener('click', () => {\n        const language = select.value;\n        const languageClass = language === 'plaintext' ? '' : `language-${language}`;\n        \n        // 插入代码块\n        this.formatText('insertHTML', `<pre><code class=\"${languageClass}\">在这里输入代码...</code></pre>`);\n        \n        // 应用代码高亮\n        this.highlightAllCode();\n        \n        // 清理对话框\n        document.body.removeChild(dialogContainer);\n        \n        // 尝试聚焦到代码块并选择占位文本\n        setTimeout(() => {\n          const codeElements = this.$refs.editorContent.querySelectorAll('pre code');\n          const lastCode = codeElements[codeElements.length - 1];\n          if (lastCode && lastCode.textContent === '在这里输入代码...') {\n            const range = document.createRange();\n            range.selectNodeContents(lastCode);\n            const selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n          }\n        }, 0);\n      });\n      \n      // 取消按钮点击事件\n      cancelBtn.addEventListener('click', () => {\n        document.body.removeChild(dialogContainer);\n      });\n    },\n    \n    // 处理键盘事件，特别是删除键\n    handleKeydown(event) {\n      // 阻止删除键可能导致的页面导航行为\n      if (event.key === 'Backspace' || event.key === 'Delete') {\n        // 阻止默认的页面导航行为\n        event.stopPropagation();\n        \n        // 确保编辑器内容区域获得焦点\n        if (this.$refs.editorContent) {\n          // 检查当前选中内容\n          const selection = window.getSelection();\n          if (selection.rangeCount > 0) {\n            const range = selection.getRangeAt(0);\n            \n            // 如果删除空内容或光标在开始位置，防止可能的页面跳转\n            if (range.startOffset === 0 && range.endOffset === 0 && range.startContainer.nodeType === 3) {\n              // 如果是文本节点的开头，确保不会触发任何特殊行为\n              const parentElement = range.startContainer.parentNode;\n              if (parentElement && parentElement.previousSibling === null) {\n                // 在顶级元素的开头，确保不会触发任何页面级导航\n                event.preventDefault();\n                \n                // 手动处理删除操作\n                if (parentElement.textContent.trim() === '' && parentElement.tagName.toLowerCase() === 'p') {\n                  // 保留空段落，防止编辑器内容完全清空\n                  return;\n                }\n                \n                // 恢复默认行为，允许删除\n                setTimeout(() => {\n                  document.execCommand('delete', false, null);\n                  this.updateContent();\n                }, 0);\n              }\n            }\n          }\n        }\n      }\n    },\n    \n    // 应用代码高亮并添加复制按钮\n    highlightAllCode() {\n      if (this.$refs.editorContent) {\n        const codeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n        codeBlocks.forEach(block => {\n          // 先应用高亮\n          this.applyHighlightToBlock(block);\n          \n          // 为代码块添加复制按钮\n          this.addCopyButtonToBlock(block);\n        });\n      }\n    },\n    \n    // 只重新高亮代码内容，不重复添加复制按钮\n    rehighlightCodeWithoutButtons() {\n      if (this.$refs.editorContent) {\n        const codeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n        codeBlocks.forEach(block => {\n          this.applyHighlightToBlock(block);\n        });\n      }\n    },\n    \n    // 应用高亮到单个代码块\n    applyHighlightToBlock(block) {\n      // 检查是否需要重新高亮（内容变化时）\n      if (!block.classList.contains('hljs') || this.needsRehighlight(block)) {\n        // 获取语言类\n        const languageClass = Array.from(block.classList).find(cls => cls.startsWith('language-'));\n        if (languageClass) {\n          const language = languageClass.replace('language-', '');\n          // 尝试使用指定语言高亮\n          if (hljs.getLanguage(language)) {\n            hljs.highlightElement(block);\n          } else {\n            // 如果指定的语言不可用，自动检测\n            hljs.highlightElement(block);\n          }\n        } else {\n          // 自动检测语言\n          hljs.highlightElement(block);\n        }\n      }\n    },\n    \n    // 判断代码块是否需要重新高亮\n    needsRehighlight(block) {\n      // 简单判断：如果代码块的子节点只有文本节点，可能需要重新高亮\n      // 或者我们可以添加一个时间戳标记上次高亮时间\n      return Array.from(block.childNodes).some(node => node.nodeType === 3);\n    },\n    \n    // 为代码块添加复制按钮\n    addCopyButtonToBlock(block) {\n      const preElement = block.parentElement;\n      // 检查是否已经有复制按钮，避免重复添加\n      if (preElement && !preElement.querySelector('.copy-button')) {\n        // 创建复制按钮\n        const copyButton = document.createElement('button');\n        copyButton.className = 'copy-button';\n        copyButton.innerHTML = '<i class=\"fa fa-copy\"></i>';\n        copyButton.title = '复制代码';\n        copyButton.addEventListener('click', (e) => {\n          e.stopPropagation();\n          this.copyCode(block.textContent);\n          // 临时更改按钮文本为\"已复制\"\n          const originalText = copyButton.innerHTML;\n          copyButton.innerHTML = '<i class=\"fa fa-check\"></i>';\n          setTimeout(() => {\n            copyButton.innerHTML = originalText;\n          }, 2000);\n        });\n        \n        // 确保pre元素有相对定位\n        if (window.getComputedStyle(preElement).position === 'static') {\n          preElement.style.position = 'relative';\n        }\n        \n        // 添加按钮到pre元素\n        preElement.appendChild(copyButton);\n      }\n    },\n    \n    // 复制代码功能\n    copyCode(text) {\n      navigator.clipboard.writeText(text).then(() => {\n        // 可以添加复制成功的提示\n        this.showNotification('代码已复制到剪贴板');\n      }).catch(err => {\n        console.error('复制失败:', err);\n      });\n    },\n    \n    // 显示通知提示\n    showNotification(message) {\n      // 创建通知元素\n      const notification = document.createElement('div');\n      notification.className = 'code-copy-notification';\n      notification.textContent = message;\n      \n      // 添加到文档\n      document.body.appendChild(notification);\n      \n      // 3秒后移除\n      setTimeout(() => {\n        notification.classList.add('fade-out');\n        setTimeout(() => {\n          document.body.removeChild(notification);\n        }, 300);\n      }, 2000);\n    },\n    \n    // 监听代码块变化并重新高亮\n    observeCodeChanges() {\n      if (this.$refs.editorContent) {\n        const observer = new MutationObserver(mutations => {\n          let needsHighlight = false;\n          \n          mutations.forEach(mutation => {\n            // 检查是否有代码块被修改或添加\n            const relevantChange = Array.from(mutation.addedNodes).some(node => {\n              if (node.nodeType === 1) {\n                // 检查是否是pre元素或包含pre code的元素\n                return node.tagName === 'PRE' || \n                       (node.querySelector && node.querySelector('pre code')) ||\n                       (node.parentElement && node.parentElement.tagName === 'PRE' && node.tagName === 'CODE');\n              }\n              return false;\n            });\n            \n            // 检查文本内容变化，可能是代码内容修改\n            const textChangeInCode = mutation.type === 'characterData' && \n                                     mutation.target.parentElement &&\n                                     mutation.target.parentElement.tagName === 'CODE' &&\n                                     mutation.target.parentElement.parentElement &&\n                                     mutation.target.parentElement.parentElement.tagName === 'PRE';\n            \n            if (relevantChange || textChangeInCode) {\n              needsHighlight = true;\n            }\n          });\n          \n          if (needsHighlight) {\n            // 延迟执行以确保DOM完全更新\n            setTimeout(() => {\n              // 只重新高亮内容，不重复添加复制按钮\n              this.rehighlightCodeWithoutButtons();\n            }, 0);\n          }\n        });\n        \n        observer.observe(this.$refs.editorContent, {\n          childList: true,\n          subtree: true,\n          characterData: true\n        });\n        \n        // 保存observer引用以便在组件销毁时清理\n        this._codeObserver = observer;\n      }\n    },\n    \n    // 手动应用代码高亮（用于粘贴或内容加载后）\n    applyHighlight() {\n      // 只重新高亮代码内容，不添加复制按钮\n      setTimeout(() => this.rehighlightCodeWithoutButtons(), 0);\n    },\n    formatDateForInput(date) {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      return `${year}-${month}-${day}`\n    },\n    updateContent() {\n      if (this.$refs.editorContent) {\n        // 保存当前光标位置\n        const selection = window.getSelection();\n        const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n        \n        // 获取当前的代码块数量，用于后续检查是否有新的代码块被添加\n        const currentCodeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n        const currentBlockCount = currentCodeBlocks.length;\n        \n        // 更新内容\n        this.articleForm.content = this.$refs.editorContent.innerHTML;\n        \n        // 先应用代码高亮\n        this.applyHighlight();\n        \n        // 检查是否有新的代码块被添加，如果有，则为新代码块添加复制按钮\n        setTimeout(() => {\n          const updatedCodeBlocks = this.$refs.editorContent.querySelectorAll('pre code');\n          if (updatedCodeBlocks.length > currentBlockCount) {\n            // 只为新添加的代码块添加复制按钮\n            const newBlocks = Array.from(updatedCodeBlocks).slice(currentBlockCount);\n            newBlocks.forEach(block => {\n              this.addCopyButtonToBlock(block);\n            });\n          }\n        }, 10);\n        \n        // 恢复光标位置（如果之前有有效光标位置）\n        setTimeout(() => {\n          if (range && selection) {\n            try {\n              selection.removeAllRanges();\n              selection.addRange(range);\n            } catch (e) {\n              // 忽略无法恢复光标的情况\n            }\n          }\n        }, 0);\n      }\n    },\n    \n    // 触发特色图片上传\n    triggerImageUpload() {\n      this.$refs.imageUpload.click()\n    },\n    \n    // 触发内容中插入图片\n    triggerImageInsert() {\n      this.$refs.imageInsert.click()\n    },\n    \n    // 处理特色图片上传\n    handleCoverImageUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 这里只是模拟上传，实际项目中应该发送到服务器\n        const reader = new FileReader()\n        reader.onload = (event) => {\n          this.articleForm.coverImage = event.target.result\n        }\n        reader.readAsDataURL(file)\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = ''\n    },\n    \n    // 处理内容图片上传\n    handleImageUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 模拟上传\n        const reader = new FileReader()\n        reader.onload = (event) => {\n          // 将图片添加到媒体列表\n          this.articleForm.media.push({\n            id: Date.now(),\n            type: 'image',\n            url: event.target.result,\n            name: file.name\n          })\n          \n          // 同时在编辑器中插入图片\n          if (this.$refs.editorContent) {\n            this.$refs.editorContent.focus()\n            this.formatText('insertHTML', `<img src=\"${event.target.result}\" alt=\"${file.name}\" class=\"max-w-full h-auto\">`)\n          }\n        }\n        reader.readAsDataURL(file)\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = ''\n    },\n    \n    // 处理视频上传\n    handleVideoUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'video',\n          url: '#',\n          name: file.name\n        })\n      }\n      e.target.value = ''\n    },\n    \n    // 处理音频上传\n    handleAudioUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'audio',\n          url: '#',\n          name: file.name\n        })\n      }\n      e.target.value = ''\n    },\n    \n    // 移除媒体\n    removeMedia(id) {\n      this.articleForm.media = this.articleForm.media.filter(media => media.id !== id)\n    },\n    // 简化版保存草稿方法\n    saveAsDraft() {\n      console.log('开始保存草稿')\n      \n      // 简化验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题')\n        return\n      }\n      \n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'draft',\n        publishedDate: this.articleForm.publishedDate,\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      }\n      \n      console.log('发出save事件（草稿）:', submitData)\n      \n      // 直接使用this.$emit\n      this.$emit('save', submitData)\n      console.log('save事件已发出')\n      alert('文章已保存为草稿')\n    },\n    \n    // 简化版发布/更新方法\n    publishArticle() {\n      console.log('开始发布/更新文章')\n      \n      // 完整验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题')\n        return\n      }\n      if (!this.articleForm.category_id) {\n        alert('请选择文章分类')\n        return\n      }\n      if (!this.articleForm.content.trim() || this.articleForm.content === '<p>开始撰写您的文章内容...</p>') {\n        alert('请输入文章内容')\n        return\n      }\n      \n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'published',\n        publishedDate: new Date().toISOString(),\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      }\n      \n      console.log('发出save事件（发布）:', submitData)\n      \n      // 直接使用this.$emit\n      this.$emit('save', submitData)\n      console.log('save事件已发出')\n      alert('文章已成功' + (this.isEditing ? '更新' : '发布'))\n    },\n     // 更新文章\n    async updateArticle() {\n      if (!this.articleForm.id) {\n        alert('请先编辑文章');\n        return;\n      }\n      \n      // 转换标签字符串为数组\n      this.articleForm.tags = this.articleForm.tagsStr.split(',').map(tag => tag.trim());\n      // 发送PUT请求更新文章\n      try {\n        const url = `http://localhost:5000/api/articles/${this.articleForm.id}`;\n        const response = await fetch(url, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(this.articleForm)\n        });\n        \n        if (!response.ok) {\n          throw new Error('Failed to update article');\n        }\n        \n        // 重置表单\n        this.showArticleEditor = false;\n      } catch (error) {\n        console.error('Error updating article:', error);\n        alert('更新文章失败，请稍后重试');\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* 编辑器样式已集成在组件中 */\n\n/* 代码块样式优化 */\n:deep(pre) {\n  background-color: #282c34 !important;\n  color: #abb2bf;\n  padding: 16px;\n  border-radius: 6px;\n  overflow-x: auto;\n  margin: 16px 0;\n  font-family: 'Fira Code', 'Courier New', monospace;\n  font-size: 14px;\n  line-height: 1.5;\n  position: relative;\n}\n\n/* 复制按钮样式 */\n:deep(.copy-button) {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  background-color: rgba(255, 255, 255, 0.1);\n  color: #abb2bf;\n  border: none;\n  border-radius: 4px;\n  padding: 6px 8px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  z-index: 10;\n}\n\n:deep(.copy-button:hover) {\n  background-color: rgba(255, 255, 255, 0.2);\n  color: #ffffff;\n}\n\n/* 复制通知样式 */\n.code-copy-notification {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  background-color: #4caf50;\n  color: white;\n  padding: 10px 15px;\n  border-radius: 4px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n  z-index: 1000;\n  transition: opacity 0.3s ease, transform 0.3s ease;\n}\n\n.code-copy-notification.fade-out {\n  opacity: 0;\n  transform: translateY(-10px);\n}\n\n:deep(pre code) {\n  background-color: transparent !important;\n  padding: 0 !important;\n  color: inherit;\n  font-family: inherit;\n  font-size: inherit;\n  line-height: inherit;\n  white-space: pre;\n  word-wrap: normal;\n}\n\n/* 滚动条样式优化 */\n:deep(pre::-webkit-scrollbar) {\n  height: 8px;\n}\n\n:deep(pre::-webkit-scrollbar-track) {\n  background: #1e1e1e;\n  border-radius: 4px;\n}\n\n:deep(pre::-webkit-scrollbar-thumb) {\n  background: #525252;\n  border-radius: 4px;\n}\n\n:deep(pre::-webkit-scrollbar-thumb:hover) {\n  background: #6e6e6e;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}