{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nexport default {\n  name: 'ArticleEditor',\n  props: {\n    article: {\n      type: Object,\n      default: null\n    },\n    categories: {\n      type: Array,\n      required: true\n    }\n  },\n  data() {\n    return {\n      articleForm: {\n        id: null,\n        title: '',\n        category_id: '',\n        // 修改为与watch中一致的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '',\n        status: 'published',\n        publishedDate: '',\n        media: []\n      }\n    };\n  },\n  computed: {\n    isEditing() {\n      return !!this.article;\n    },\n    contentWordCount() {\n      const plainText = this.articleForm.content.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ');\n      return plainText.trim().length;\n    }\n  },\n  watch: {\n    article: {\n      immediate: true,\n      handler(newVal) {\n        if (newVal) {\n          // 根据文章分类名称查找对应的分类ID\n          const categoryId = this.categories.find(c => c.name === newVal.category)?.id || '';\n          this.articleForm = {\n            id: newVal.id,\n            title: newVal.title,\n            category_id: categoryId,\n            tagsStr: newVal.tags.join(','),\n            coverImage: newVal.coverImage,\n            content: newVal.content || '<p></p>',\n            status: 'published',\n            publishedDate: this.formatDateForInput(new Date(newVal.publishedDate)),\n            media: []\n          };\n        } else {\n          this.resetForm();\n        }\n      }\n    }\n  },\n  mounted() {\n    if (!this.isEditing) {\n      this.resetForm();\n    } else {\n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content || '<p></p>';\n        }\n      });\n    }\n\n    // 添加粘贴事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.addEventListener('paste', this.handlePaste);\n    }\n  },\n  beforeUnmount() {\n    // 移除事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.removeEventListener('paste', this.handlePaste);\n    }\n  },\n  methods: {\n    // 取消编辑\n    cancelEdit() {\n      if (confirm('确定要取消编辑吗？未保存的内容将丢失。')) {\n        this.$emit('cancel');\n      }\n    },\n    resetForm() {\n      this.articleForm = {\n        id: null,\n        title: '',\n        category_id: '',\n        // 确保这里也是正确的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '<p>开始撰写您的文章内容...</p>',\n        status: 'published',\n        publishedDate: this.formatDateForInput(new Date()),\n        media: []\n      };\n\n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content;\n        }\n      });\n    },\n    // 处理粘贴事件\n    async handlePaste(event) {\n      // 阻止默认粘贴行为\n      event.preventDefault();\n\n      // 获取粘贴的内容\n      const clipboardData = event.clipboardData || window.clipboardData;\n      let html = clipboardData.getData('text/html');\n      if (html) {\n        // 创建临时DOM元素来处理HTML\n        const tempDiv = document.createElement('div');\n        tempDiv.innerHTML = html;\n\n        // 查找所有图片元素\n        const images = tempDiv.querySelectorAll('img');\n        const imagePromises = [];\n\n        // 对每个图片进行处理\n        images.forEach(img => {\n          const src = img.src;\n          if (src && !src.startsWith('data:')) {\n            // 为每个图片创建一个Promise\n            const promise = this.convertImageToDataURL(src).then(dataURL => {\n              // 替换图片src为DataURL\n              img.src = dataURL;\n              img.srcset = ''; // 清空srcset以避免冲突\n              // 添加适当的样式\n              img.classList.add('max-w-full', 'h-auto');\n            }).catch(error => {\n              console.error('图片转换失败:', src, error);\n              // 如果转换失败，使用占位图或保留原图\n              img.onerror = function () {\n                this.src = 'https://picsum.photos/800/400'; // 占位图\n                console.log('使用占位图代替无法加载的图片');\n              };\n            });\n            imagePromises.push(promise);\n          }\n        });\n\n        // 等待所有图片处理完成\n        await Promise.all(imagePromises);\n\n        // 获取处理后的HTML\n        const processedHtml = tempDiv.innerHTML;\n\n        // 插入到编辑器\n        this.formatText('insertHTML', processedHtml);\n      } else {\n        // 如果没有HTML内容，只粘贴纯文本\n        const text = clipboardData.getData('text/plain');\n        if (text) {\n          this.formatText('insertText', text);\n        }\n      }\n    },\n    // 将图片URL转换为DataURL\n    convertImageToDataURL(url) {\n      return new Promise((resolve, reject) => {\n        // 创建一个新的图片对象\n        const img = new Image();\n\n        // 设置CORS以允许跨域图片\n        img.crossOrigin = 'anonymous';\n        img.onload = function () {\n          // 创建canvas元素\n          const canvas = document.createElement('canvas');\n          canvas.width = this.width;\n          canvas.height = this.height;\n\n          // 绘制图片到canvas\n          const ctx = canvas.getContext('2d');\n          ctx.drawImage(this, 0, 0);\n          try {\n            // 转换为DataURL\n            const dataURL = canvas.toDataURL('image/jpeg');\n            resolve(dataURL);\n          } catch (error) {\n            // 如果toDataURL失败（可能是由于CORS限制），尝试使用fetch\n            fetch(url, {\n              mode: 'cors',\n              headers: {\n                'Content-Type': 'image/jpeg'\n              }\n            }).then(response => response.blob()).then(blob => {\n              const reader = new FileReader();\n              reader.onloadend = () => resolve(reader.result);\n              reader.readAsDataURL(blob);\n            }).catch(fetchError => {\n              console.error('获取图片失败:', fetchError);\n              reject(fetchError);\n            });\n          }\n        };\n        img.onerror = function () {\n          reject(new Error('图片加载失败'));\n        };\n\n        // 开始加载图片\n        img.src = url;\n      });\n    },\n    // 富文本编辑核心方法\n    formatText(command, value = null) {\n      // 先确保编辑器获得焦点\n      if (this.$refs.editorContent) {\n        this.$refs.editorContent.focus();\n\n        // 尝试执行命令\n        try {\n          // 对于formatBlock命令，需要特殊处理\n          if (command === 'formatBlock' && value) {\n            document.execCommand('formatBlock', false, `<${value}>`);\n          } else {\n            document.execCommand(command, false, value);\n          }\n          this.updateContent();\n        } catch (error) {\n          console.error('编辑器命令执行失败:', error);\n        }\n      }\n    },\n    // 插入链接\n    insertLink() {\n      const url = prompt('请输入链接地址:', 'http://');\n      if (url) {\n        this.formatText('createLink', url);\n      }\n    },\n    // 插入视频\n    insertVideo() {\n      const url = prompt('请输入视频地址:', 'http://');\n      if (url) {\n        this.formatText('insertHTML', `<video controls width=\"100%\" src=\"${url}\"></video>`);\n      }\n    },\n    // 插入代码块\n    insertCodeBlock() {\n      this.formatText('insertHTML', '<pre><code>在这里输入代码...</code></pre>');\n    },\n    formatDateForInput(date) {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    },\n    updateContent() {\n      if (this.$refs.editorContent) {\n        this.articleForm.content = this.$refs.editorContent.innerHTML;\n      }\n    },\n    // 触发特色图片上传\n    triggerImageUpload() {\n      this.$refs.imageUpload.click();\n    },\n    // 触发内容中插入图片\n    triggerImageInsert() {\n      this.$refs.imageInsert.click();\n    },\n    // 处理特色图片上传\n    handleCoverImageUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 这里只是模拟上传，实际项目中应该发送到服务器\n        const reader = new FileReader();\n        reader.onload = event => {\n          this.articleForm.coverImage = event.target.result;\n        };\n        reader.readAsDataURL(file);\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = '';\n    },\n    // 处理内容图片上传\n    handleImageUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 模拟上传\n        const reader = new FileReader();\n        reader.onload = event => {\n          // 将图片添加到媒体列表\n          this.articleForm.media.push({\n            id: Date.now(),\n            type: 'image',\n            url: event.target.result,\n            name: file.name\n          });\n\n          // 同时在编辑器中插入图片\n          if (this.$refs.editorContent) {\n            this.$refs.editorContent.focus();\n            this.formatText('insertHTML', `<img src=\"${event.target.result}\" alt=\"${file.name}\" class=\"max-w-full h-auto\">`);\n          }\n        };\n        reader.readAsDataURL(file);\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = '';\n    },\n    // 处理视频上传\n    handleVideoUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'video',\n          url: '#',\n          name: file.name\n        });\n      }\n      e.target.value = '';\n    },\n    // 处理音频上传\n    handleAudioUpload(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'audio',\n          url: '#',\n          name: file.name\n        });\n      }\n      e.target.value = '';\n    },\n    // 移除媒体\n    removeMedia(id) {\n      this.articleForm.media = this.articleForm.media.filter(media => media.id !== id);\n    },\n    // 简化版保存草稿方法\n    saveAsDraft() {\n      console.log('开始保存草稿');\n\n      // 简化验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题');\n        return;\n      }\n\n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'draft',\n        publishedDate: this.articleForm.publishedDate,\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      };\n      console.log('发出save事件（草稿）:', submitData);\n\n      // 直接使用this.$emit\n      this.$emit('save', submitData);\n      console.log('save事件已发出');\n      alert('文章已保存为草稿');\n    },\n    // 简化版发布/更新方法\n    publishArticle() {\n      console.log('开始发布/更新文章');\n\n      // 完整验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题');\n        return;\n      }\n      if (!this.articleForm.category_id) {\n        alert('请选择文章分类');\n        return;\n      }\n      if (!this.articleForm.content.trim() || this.articleForm.content === '<p>开始撰写您的文章内容...</p>') {\n        alert('请输入文章内容');\n        return;\n      }\n\n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'published',\n        publishedDate: new Date().toISOString(),\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      };\n      console.log('发出save事件（发布）:', submitData);\n\n      // 直接使用this.$emit\n      this.$emit('save', submitData);\n      console.log('save事件已发出');\n      alert('文章已成功' + (this.isEditing ? '更新' : '发布'));\n    },\n    // 更新文章\n    async updateArticle() {\n      if (!this.articleForm.id) {\n        alert('请先编辑文章');\n        return;\n      }\n\n      // 转换标签字符串为数组\n      this.articleForm.tags = this.articleForm.tagsStr.split(',').map(tag => tag.trim());\n      // 发送PUT请求更新文章\n      try {\n        const url = `http://localhost:5000/api/articles/${this.articleForm.id}`;\n        const response = await fetch(url, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(this.articleForm)\n        });\n        if (!response.ok) {\n          throw new Error('Failed to update article');\n        }\n\n        // 重置表单\n        this.showArticleEditor = false;\n      } catch (error) {\n        console.error('Error updating article:', error);\n        alert('更新文章失败，请稍后重试');\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","props","article","type","Object","default","categories","Array","required","data","articleForm","id","title","category_id","tagsStr","coverImage","content","status","publishedDate","media","computed","isEditing","contentWordCount","plainText","replace","trim","length","watch","immediate","handler","newVal","categoryId","find","c","category","tags","join","formatDateForInput","Date","resetForm","mounted","$nextTick","$refs","editorContent","innerHTML","addEventListener","handlePaste","beforeUnmount","removeEventListener","methods","cancelEdit","confirm","$emit","event","preventDefault","clipboardData","window","html","getData","tempDiv","document","createElement","images","querySelectorAll","imagePromises","forEach","img","src","startsWith","promise","convertImageToDataURL","then","dataURL","srcset","classList","add","catch","error","console","onerror","log","push","Promise","all","processedHtml","formatText","text","url","resolve","reject","Image","crossOrigin","onload","canvas","width","height","ctx","getContext","drawImage","toDataURL","fetch","mode","headers","response","blob","reader","FileReader","onloadend","result","readAsDataURL","fetchError","Error","command","value","focus","execCommand","updateContent","insertLink","prompt","insertVideo","insertCodeBlock","date","year","getFullYear","month","String","getMonth","padStart","day","getDate","triggerImageUpload","imageUpload","click","triggerImageInsert","imageInsert","handleCoverImageUpload","e","file","target","files","handleImageUpload","now","handleVideoUpload","handleAudioUpload","removeMedia","filter","saveAsDraft","alert","submitData","split","map","tag","publishArticle","toISOString","updateArticle","method","body","JSON","stringify","ok","showArticleEditor"],"sources":["/Users/yudesong/Project/Vue/blog/src/components/ArticleEditor.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <div class=\"max-w-5xl mx-auto p-4 bg-white min-h-screen\">\n      <!-- 模态框头部 -->\n      <div class=\"flex justify-between items-center p-4 border-b border-gray-200\">\n        <h3 class=\"text-lg font-medium text-gray-800\">{{ isEditing ? '编辑文章' : '新建文章' }}</h3>\n        <div class=\"flex space-x-2\">\n          <button \n            class=\"px-3 py-1 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors\"\n            @click=\"$emit('close')\"\n          >\n            取消\n          </button>\n          <button \n            class=\"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors\"\n            @click=\"saveArticle\"\n          >\n            保存\n          </button>\n        </div>\n      </div>\n      \n      <!-- 模态框内容 -->\n      <div class=\"flex-1 overflow-y-auto p-4\">\n        <!-- 文章基本信息 -->\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n          <div class=\"md:col-span-2\">\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">文章标题</label>\n            <input \n              v-model=\"articleForm.title\"\n              type=\"text\" \n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"请输入文章标题\"\n              maxlength=\"100\"\n            />\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">文章分类</label>\n            <select \n              v-model=\"articleForm.category_id\"\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"\">请选择分类</option>\n              <option v-for=\"category in categories\" :key=\"category.id\" :value=\"category.id\">\n                {{ category.name }}\n              </option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">文章标签</label>\n            <input \n              v-model=\"articleForm.tagsStr\"\n              type=\"text\" \n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"多个标签用逗号分隔\"\n            />\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">发布日期</label>\n            <input \n              v-model=\"articleForm.publishedDate\"\n              type=\"date\" \n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n        \n        <!-- 特色图片 -->\n        <div class=\"mb-6\">\n          <label class=\"block text-sm font-medium text-gray-700 mb-2\">特色图片</label>\n          <div class=\"flex items-center space-x-4\">\n            <div v-if=\"articleForm.coverImage\" class=\"w-32 h-20 rounded overflow-hidden border border-gray-200\">\n              <img :src=\"articleForm.coverImage\" alt=\"封面图片\" class=\"w-full h-full object-cover\" />\n            </div>\n            <button \n              class=\"px-3 py-1 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center\"\n              @click=\"triggerImageUpload\"\n            >\n              <i class=\"fa fa-upload mr-1\"></i>\n              上传图片\n            </button>\n            <input \n              ref=\"imageUpload\"\n              type=\"file\" \n              accept=\"image/*\"\n              class=\"hidden\"\n              @change=\"handleCoverImageUpload\"\n            />\n          </div>\n        </div>\n        \n        <!-- 文章内容编辑器 -->\n        <div class=\"mb-6\">\n          <label class=\"block text-sm font-medium text-gray-700 mb-2\">文章内容</label>\n          \n          <!-- 编辑器工具栏 -->\n          <div class=\"border border-gray-300 rounded-t-lg p-2 bg-gray-50 flex flex-wrap gap-1\">\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"加粗\" @click=\"formatText('bold')\"><i class=\"fa fa-bold\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"斜体\" @click=\"formatText('italic')\"><i class=\"fa fa-italic\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"下划线\" @click=\"formatText('underline')\"><i class=\"fa fa-underline\"></i></button>\n            <span class=\"border-r border-gray-300 h-6 mx-1\"></span>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"H2标题\" @click=\"formatText('formatBlock', 'h2')\"><i class=\"fa fa-header\"></i>H2</button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"H3标题\" @click=\"formatText('formatBlock', 'h3')\"><i class=\"fa fa-header\"></i>H3</button>\n            <span class=\"border-r border-gray-300 h-6 mx-1\"></span>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"无序列表\" @click=\"formatText('insertUnorderedList')\"><i class=\"fa fa-list-ul\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"有序列表\" @click=\"formatText('insertOrderedList')\"><i class=\"fa fa-list-ol\"></i></button>\n            <span class=\"border-r border-gray-300 h-6 mx-1\"></span>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入链接\" @click=\"insertLink\"><i class=\"fa fa-link\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入图片\" @click=\"triggerImageInsert\"><i class=\"fa fa-image\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入视频\" @click=\"insertVideo\"><i class=\"fa fa-video\"></i></button>\n            <button class=\"p-1 hover:bg-gray-200 rounded\" title=\"插入代码块\" @click=\"insertCodeBlock\"><i class=\"fa fa-code\"></i></button>\n          </div>\n          \n          <!-- 编辑器内容区 -->\n          <div \n            ref=\"editorContent\"\n            contenteditable=\"true\"\n            class=\"border border-gray-300 border-t-0 rounded-b-lg p-4 min-h-[300px] focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            v-html=\"articleForm.content\"\n            @input=\"updateContent\"\n          ></div>\n        </div>\n        \n        <!-- 媒体上传区域 -->\n        <div class=\"mb-4\" v-if=\"articleForm.media.length > 0\">\n          <label class=\"block text-sm font-medium text-gray-700 mb-2\">上传的媒体</label>\n          <div class=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\n            <div v-for=\"media in articleForm.media\" :key=\"media.id\" class=\"relative\">\n              <div class=\"bg-gray-100 rounded p-2 flex flex-col items-center justify-center\">\n                <i v-if=\"media.type === 'video'\" class=\"fa fa-video text-gray-500 text-2xl mb-1\"></i>\n                <i v-else-if=\"media.type === 'audio'\" class=\"fa fa-music text-gray-500 text-2xl mb-1\"></i>\n                <img v-else :src=\"media.url\" alt=\"媒体预览\" class=\"w-full h-20 object-cover rounded mb-1\" />\n                <div class=\"text-xs text-gray-500 truncate text-center\">{{ media.name }}</div>\n              </div>\n              <button \n                class=\"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors\"\n                @click=\"removeMedia(media.id)\"\n              >\n                <i class=\"fa fa-times text-xs\"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 页面底部操作区 -->\n      <div class=\"fixed bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-white shadow-lg\">\n        <div class=\"max-w-5xl mx-auto flex justify-between items-center\">\n          <div class=\"text-sm text-gray-500\">\n            字数统计：{{ contentWordCount }}\n          </div>\n          <div>\n            <button \n              class=\"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-100 mr-2 transition-colors\"\n              @click=\"cancelEdit\"\n            >\n              取消\n            </button>\n            <button \n              class=\"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-100 mr-2 transition-colors\"\n              @click=\"saveAsDraft\"\n            >\n              保存为草稿\n            </button>\n            <button \n              class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n              @click=\"publishArticle\"\n            >\n              {{ isEditing ? '更新文章' : '发布文章' }}\n            </button>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 隐藏的文件上传输入 -->\n      <input \n        ref=\"imageInsert\"\n        type=\"file\" \n        accept=\"image/*\"\n        class=\"hidden\"\n        @change=\"handleImageUpload\"\n      />\n      <input \n        ref=\"videoUpload\"\n        type=\"file\" \n        accept=\"video/*\"\n        class=\"hidden\"\n        @change=\"handleVideoUpload\"\n      />\n      <input \n        ref=\"audioUpload\"\n        type=\"file\" \n        accept=\"audio/*\"\n        class=\"hidden\"\n        @change=\"handleAudioUpload\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ArticleEditor',\n  props: {\n    article: {\n      type: Object,\n      default: null\n    },\n    categories: {\n      type: Array,\n      required: true\n    }\n  },\n  data() {\n    return {\n      articleForm: {\n        id: null,\n        title: '',\n        category_id: '', // 修改为与watch中一致的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '',\n        status: 'published',\n        publishedDate: '',\n        media: []\n      }\n    }\n  },\n  computed: {\n    isEditing() {\n      return !!this.article\n    },\n    contentWordCount() {\n      const plainText = this.articleForm.content.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ')\n      return plainText.trim().length\n    }\n  },\n  watch: {\n    article: {\n      immediate: true,\n      handler(newVal) {\n        if (newVal) {\n          // 根据文章分类名称查找对应的分类ID\n          const categoryId = this.categories.find(c => c.name === newVal.category)?.id || '';\n          \n          this.articleForm = {\n            id: newVal.id,\n            title: newVal.title,\n            category_id: categoryId,\n            tagsStr: newVal.tags.join(','),\n            coverImage: newVal.coverImage,\n            content: newVal.content || '<p></p>',\n            status: 'published',\n            publishedDate: this.formatDateForInput(new Date(newVal.publishedDate)),\n            media: []\n          }\n        } else {\n          this.resetForm()\n        }\n      }\n    }\n  },\n  mounted() {\n    if (!this.isEditing) {\n      this.resetForm()\n    } else {\n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content || '<p></p>';\n        }\n      })\n    }\n    \n    // 添加粘贴事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.addEventListener('paste', this.handlePaste);\n    }\n  },\n  \n  beforeUnmount() {\n    // 移除事件监听\n    if (this.$refs.editorContent) {\n      this.$refs.editorContent.removeEventListener('paste', this.handlePaste);\n    }\n  },\n  methods: {\n    // 取消编辑\n    cancelEdit() {\n      if (confirm('确定要取消编辑吗？未保存的内容将丢失。')) {\n        this.$emit('cancel')\n      }\n    },\n    \n    resetForm() {\n      this.articleForm = {\n        id: null,\n        title: '',\n        category_id: '', // 确保这里也是正确的字段名\n        tagsStr: '',\n        coverImage: '',\n        content: '<p>开始撰写您的文章内容...</p>',\n        status: 'published',\n        publishedDate: this.formatDateForInput(new Date()),\n        media: []\n      }\n      \n      // 使用nextTick确保DOM渲染完成\n      this.$nextTick(() => {\n        if (this.$refs.editorContent) {\n          this.$refs.editorContent.innerHTML = this.articleForm.content;\n        }\n      });\n    },\n    \n    // 处理粘贴事件\n    async handlePaste(event) {\n      // 阻止默认粘贴行为\n      event.preventDefault();\n      \n      // 获取粘贴的内容\n      const clipboardData = event.clipboardData || window.clipboardData;\n      let html = clipboardData.getData('text/html');\n      \n      if (html) {\n        // 创建临时DOM元素来处理HTML\n        const tempDiv = document.createElement('div');\n        tempDiv.innerHTML = html;\n        \n        // 查找所有图片元素\n        const images = tempDiv.querySelectorAll('img');\n        const imagePromises = [];\n        \n        // 对每个图片进行处理\n        images.forEach(img => {\n          const src = img.src;\n          if (src && !src.startsWith('data:')) {\n            // 为每个图片创建一个Promise\n            const promise = this.convertImageToDataURL(src).then(dataURL => {\n              // 替换图片src为DataURL\n              img.src = dataURL;\n              img.srcset = ''; // 清空srcset以避免冲突\n              // 添加适当的样式\n              img.classList.add('max-w-full', 'h-auto');\n            }).catch(error => {\n              console.error('图片转换失败:', src, error);\n              // 如果转换失败，使用占位图或保留原图\n              img.onerror = function() {\n                this.src = 'https://picsum.photos/800/400'; // 占位图\n                console.log('使用占位图代替无法加载的图片');\n              };\n            });\n            imagePromises.push(promise);\n          }\n        });\n        \n        // 等待所有图片处理完成\n        await Promise.all(imagePromises);\n        \n        // 获取处理后的HTML\n        const processedHtml = tempDiv.innerHTML;\n        \n        // 插入到编辑器\n        this.formatText('insertHTML', processedHtml);\n      } else {\n        // 如果没有HTML内容，只粘贴纯文本\n        const text = clipboardData.getData('text/plain');\n        if (text) {\n          this.formatText('insertText', text);\n        }\n      }\n    },\n    \n    // 将图片URL转换为DataURL\n    convertImageToDataURL(url) {\n      return new Promise((resolve, reject) => {\n        // 创建一个新的图片对象\n        const img = new Image();\n        \n        // 设置CORS以允许跨域图片\n        img.crossOrigin = 'anonymous';\n        \n        img.onload = function() {\n          // 创建canvas元素\n          const canvas = document.createElement('canvas');\n          canvas.width = this.width;\n          canvas.height = this.height;\n          \n          // 绘制图片到canvas\n          const ctx = canvas.getContext('2d');\n          ctx.drawImage(this, 0, 0);\n          \n          try {\n            // 转换为DataURL\n            const dataURL = canvas.toDataURL('image/jpeg');\n            resolve(dataURL);\n          } catch (error) {\n            // 如果toDataURL失败（可能是由于CORS限制），尝试使用fetch\n            fetch(url, {\n              mode: 'cors',\n              headers: {\n                'Content-Type': 'image/jpeg'\n              }\n            })\n            .then(response => response.blob())\n            .then(blob => {\n              const reader = new FileReader();\n              reader.onloadend = () => resolve(reader.result);\n              reader.readAsDataURL(blob);\n            })\n            .catch(fetchError => {\n              console.error('获取图片失败:', fetchError);\n              reject(fetchError);\n            });\n          }\n        };\n        \n        img.onerror = function() {\n          reject(new Error('图片加载失败'));\n        };\n        \n        // 开始加载图片\n        img.src = url;\n      });\n    },\n    \n    // 富文本编辑核心方法\n    formatText(command, value = null) {\n      // 先确保编辑器获得焦点\n      if (this.$refs.editorContent) {\n        this.$refs.editorContent.focus();\n        \n        // 尝试执行命令\n        try {\n          // 对于formatBlock命令，需要特殊处理\n          if (command === 'formatBlock' && value) {\n            document.execCommand('formatBlock', false, `<${value}>`);\n          } else {\n            document.execCommand(command, false, value);\n          }\n          this.updateContent();\n        } catch (error) {\n          console.error('编辑器命令执行失败:', error);\n        }\n      }\n    },\n    \n    // 插入链接\n    insertLink() {\n      const url = prompt('请输入链接地址:', 'http://');\n      if (url) {\n        this.formatText('createLink', url);\n      }\n    },\n    \n    // 插入视频\n    insertVideo() {\n      const url = prompt('请输入视频地址:', 'http://');\n      if (url) {\n        this.formatText('insertHTML', `<video controls width=\"100%\" src=\"${url}\"></video>`);\n      }\n    },\n    \n    // 插入代码块\n    insertCodeBlock() {\n      this.formatText('insertHTML', '<pre><code>在这里输入代码...</code></pre>');\n    },\n    formatDateForInput(date) {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      return `${year}-${month}-${day}`\n    },\n    updateContent() {\n      if (this.$refs.editorContent) {\n        this.articleForm.content = this.$refs.editorContent.innerHTML\n      }\n    },\n    \n    // 触发特色图片上传\n    triggerImageUpload() {\n      this.$refs.imageUpload.click()\n    },\n    \n    // 触发内容中插入图片\n    triggerImageInsert() {\n      this.$refs.imageInsert.click()\n    },\n    \n    // 处理特色图片上传\n    handleCoverImageUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 这里只是模拟上传，实际项目中应该发送到服务器\n        const reader = new FileReader()\n        reader.onload = (event) => {\n          this.articleForm.coverImage = event.target.result\n        }\n        reader.readAsDataURL(file)\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = ''\n    },\n    \n    // 处理内容图片上传\n    handleImageUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 模拟上传\n        const reader = new FileReader()\n        reader.onload = (event) => {\n          // 将图片添加到媒体列表\n          this.articleForm.media.push({\n            id: Date.now(),\n            type: 'image',\n            url: event.target.result,\n            name: file.name\n          })\n          \n          // 同时在编辑器中插入图片\n          if (this.$refs.editorContent) {\n            this.$refs.editorContent.focus()\n            this.formatText('insertHTML', `<img src=\"${event.target.result}\" alt=\"${file.name}\" class=\"max-w-full h-auto\">`)\n          }\n        }\n        reader.readAsDataURL(file)\n      }\n      // 重置input，允许重复上传同一文件\n      e.target.value = ''\n    },\n    \n    // 处理视频上传\n    handleVideoUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'video',\n          url: '#',\n          name: file.name\n        })\n      }\n      e.target.value = ''\n    },\n    \n    // 处理音频上传\n    handleAudioUpload(e) {\n      const file = e.target.files[0]\n      if (file) {\n        // 模拟上传\n        this.articleForm.media.push({\n          id: Date.now(),\n          type: 'audio',\n          url: '#',\n          name: file.name\n        })\n      }\n      e.target.value = ''\n    },\n    \n    // 移除媒体\n    removeMedia(id) {\n      this.articleForm.media = this.articleForm.media.filter(media => media.id !== id)\n    },\n    // 简化版保存草稿方法\n    saveAsDraft() {\n      console.log('开始保存草稿')\n      \n      // 简化验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题')\n        return\n      }\n      \n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'draft',\n        publishedDate: this.articleForm.publishedDate,\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      }\n      \n      console.log('发出save事件（草稿）:', submitData)\n      \n      // 直接使用this.$emit\n      this.$emit('save', submitData)\n      console.log('save事件已发出')\n      alert('文章已保存为草稿')\n    },\n    \n    // 简化版发布/更新方法\n    publishArticle() {\n      console.log('开始发布/更新文章')\n      \n      // 完整验证\n      if (!this.articleForm.title.trim()) {\n        alert('请输入文章标题')\n        return\n      }\n      if (!this.articleForm.category_id) {\n        alert('请选择文章分类')\n        return\n      }\n      if (!this.articleForm.content.trim() || this.articleForm.content === '<p>开始撰写您的文章内容...</p>') {\n        alert('请输入文章内容')\n        return\n      }\n      \n      // 准备提交数据\n      const submitData = {\n        id: this.articleForm.id,\n        title: this.articleForm.title,\n        category_id: this.articleForm.category_id,\n        content: this.articleForm.content,\n        status: 'published',\n        publishedDate: new Date().toISOString(),\n        coverImage: this.articleForm.coverImage,\n        tags: this.articleForm.tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag)\n      }\n      \n      console.log('发出save事件（发布）:', submitData)\n      \n      // 直接使用this.$emit\n      this.$emit('save', submitData)\n      console.log('save事件已发出')\n      alert('文章已成功' + (this.isEditing ? '更新' : '发布'))\n    },\n     // 更新文章\n    async updateArticle() {\n      if (!this.articleForm.id) {\n        alert('请先编辑文章');\n        return;\n      }\n      \n      // 转换标签字符串为数组\n      this.articleForm.tags = this.articleForm.tagsStr.split(',').map(tag => tag.trim());\n      // 发送PUT请求更新文章\n      try {\n        const url = `http://localhost:5000/api/articles/${this.articleForm.id}`;\n        const response = await fetch(url, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(this.articleForm)\n        });\n        \n        if (!response.ok) {\n          throw new Error('Failed to update article');\n        }\n        \n        // 重置表单\n        this.showArticleEditor = false;\n      } catch (error) {\n        console.error('Error updating article:', error);\n        alert('更新文章失败，请稍后重试');\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* 编辑器样式已集成在组件中 */\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}