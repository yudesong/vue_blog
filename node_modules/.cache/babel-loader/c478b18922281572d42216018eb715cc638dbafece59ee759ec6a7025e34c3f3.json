{"ast":null,"code":"export default {\n  name: 'UserLogin',\n  emits: ['switchToRegister', 'loginSuccess'],\n  data() {\n    return {\n      form: {\n        loginInput: '',\n        password: '',\n        rememberMe: false\n      },\n      errors: {},\n      isSubmitting: false\n    };\n  },\n  methods: {\n    // 表单验证\n    validateForm() {\n      this.errors = {};\n      let isValid = true;\n\n      // 验证登录输入\n      if (!this.form.loginInput.trim()) {\n        this.errors.loginInput = '请输入用户名或邮箱';\n        isValid = false;\n      }\n\n      // 验证密码\n      if (!this.form.password) {\n        this.errors.password = '请输入密码';\n        isValid = false;\n      }\n      return isValid;\n    },\n    // 处理登录\n    async handleLogin() {\n      if (!this.validateForm()) {\n        return;\n      }\n      this.isSubmitting = true;\n      try {\n        const response = await fetch('http://localhost:5000/api/auth/login', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            username: this.form.loginInput,\n            // 后端目前只接受username参数，我们传入loginInput\n            password: this.form.password\n          })\n        });\n        const data = await response.json();\n        if (!response.ok) {\n          // 处理登录失败\n          if (data.error) {\n            alert('登录失败：' + data.error);\n          }\n          return;\n        }\n\n        // 登录成功，保存用户信息\n        const userData = {\n          id: data.id,\n          username: data.username,\n          email: data.email,\n          isAdmin: data.isAdmin,\n          token: data.token\n        };\n\n        // 如果选择记住我，保存到localStorage，否则保存到sessionStorage\n        const storage = this.form.rememberMe ? localStorage : sessionStorage;\n        storage.setItem('user', JSON.stringify(userData));\n\n        // 触发登录成功事件\n        this.$emit('loginSuccess', userData);\n\n        // 显示成功消息\n        alert('登录成功！');\n\n        // 重置表单\n        this.form = {\n          loginInput: '',\n          password: '',\n          rememberMe: false\n        };\n\n        // 可以在这里跳转到首页或其他页面\n        this.$parent.switchView('home');\n      } catch (error) {\n        console.error('登录错误:', error);\n        alert('登录失败，请稍后再试');\n      } finally {\n        this.isSubmitting = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","emits","data","form","loginInput","password","rememberMe","errors","isSubmitting","methods","validateForm","isValid","trim","handleLogin","response","fetch","method","headers","body","JSON","stringify","username","json","ok","error","alert","userData","id","email","isAdmin","token","storage","localStorage","sessionStorage","setItem","$emit","$parent","switchView","console"],"sources":["/Users/yudesong/Project/Vue/blog/src/components/UserLogin.vue"],"sourcesContent":["<template>\n  <div class=\"flex justify-center items-center min-h-[70vh] py-12\">\n    <div class=\"w-full max-w-md bg-white rounded-xl shadow-lg overflow-hidden\">\n      <div class=\"p-8\">\n        <div class=\"text-center mb-8\">\n          <div class=\"flex justify-center mb-4\">\n            <i class=\"fa fa-sign-in text-indigo-600 text-4xl\"></i>\n          </div>\n          <h2 class=\"text-2xl font-bold text-gray-900\">登录账户</h2>\n          <p class=\"text-gray-600 mt-2\">欢迎回来，请登录您的账户</p>\n        </div>\n        \n        <form @submit.prevent=\"handleLogin\" class=\"space-y-4\">\n          <!-- 用户名/邮箱输入 -->\n          <div>\n            <label for=\"loginInput\" class=\"block text-sm font-medium text-gray-700 mb-1\">用户名或邮箱</label>\n            <input\n              id=\"loginInput\"\n              v-model=\"form.loginInput\"\n              type=\"text\"\n              required\n              class=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors\"\n              placeholder=\"请输入用户名或邮箱\"\n            >\n            <div v-if=\"errors.loginInput\" class=\"text-red-500 text-xs mt-1\">{{ errors.loginInput }}</div>\n          </div>\n          \n          <!-- 密码输入 -->\n          <div>\n            <div class=\"flex justify-between items-center\">\n              <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-1\">密码</label>\n              <a href=\"#\" class=\"text-xs text-indigo-600 hover:text-indigo-700 font-medium\">忘记密码？</a>\n            </div>\n            <input\n              id=\"password\"\n              v-model=\"form.password\"\n              type=\"password\"\n              required\n              class=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors\"\n              placeholder=\"请输入密码\"\n            >\n            <div v-if=\"errors.password\" class=\"text-red-500 text-xs mt-1\">{{ errors.password }}</div>\n          </div>\n          \n          <!-- 记住我 -->\n          <div class=\"flex items-center\">\n            <input\n              id=\"rememberMe\"\n              v-model=\"form.rememberMe\"\n              type=\"checkbox\"\n              class=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n            >\n            <label for=\"rememberMe\" class=\"ml-2 block text-sm text-gray-700\">记住我</label>\n          </div>\n          \n          <!-- 登录按钮 -->\n          <button\n            type=\"submit\"\n            :disabled=\"isSubmitting\"\n            class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md transition-colors flex justify-center items-center\"\n          >\n            <span v-if=\"!isSubmitting\">登录</span>\n            <span v-else class=\"flex items-center\">\n              <i class=\"fa fa-spinner fa-spin mr-2\"></i>\n              登录中...\n            </span>\n          </button>\n          \n          <!-- 没有账户 -->\n          <div class=\"text-center text-sm text-gray-600\">\n            没有账户？ <a href=\"#\" @click.prevent=\"$emit('switchToRegister')\" class=\"text-indigo-600 hover:text-indigo-700 font-medium\">注册</a>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'UserLogin',\n  emits: ['switchToRegister', 'loginSuccess'],\n  data() {\n    return {\n      form: {\n        loginInput: '',\n        password: '',\n        rememberMe: false\n      },\n      errors: {},\n      isSubmitting: false\n    }\n  },\n  methods: {\n    // 表单验证\n    validateForm() {\n      this.errors = {}\n      let isValid = true\n      \n      // 验证登录输入\n      if (!this.form.loginInput.trim()) {\n        this.errors.loginInput = '请输入用户名或邮箱'\n        isValid = false\n      }\n      \n      // 验证密码\n      if (!this.form.password) {\n        this.errors.password = '请输入密码'\n        isValid = false\n      }\n      \n      return isValid\n    },\n    \n    // 处理登录\n    async handleLogin() {\n      if (!this.validateForm()) {\n        return\n      }\n      \n      this.isSubmitting = true\n      \n      try {\n        const response = await fetch('http://localhost:5000/api/auth/login', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            username: this.form.loginInput,  // 后端目前只接受username参数，我们传入loginInput\n            password: this.form.password\n          })\n        })\n        \n        const data = await response.json()\n        \n        if (!response.ok) {\n          // 处理登录失败\n          if (data.error) {\n            alert('登录失败：' + data.error)\n          }\n          return\n        }\n        \n        // 登录成功，保存用户信息\n        const userData = {\n          id: data.id,\n          username: data.username,\n          email: data.email,\n          isAdmin: data.isAdmin,\n          token: data.token\n        }\n        \n        // 如果选择记住我，保存到localStorage，否则保存到sessionStorage\n        const storage = this.form.rememberMe ? localStorage : sessionStorage\n        storage.setItem('user', JSON.stringify(userData))\n        \n        // 触发登录成功事件\n        this.$emit('loginSuccess', userData)\n        \n        // 显示成功消息\n        alert('登录成功！')\n        \n        // 重置表单\n        this.form = {\n          loginInput: '',\n          password: '',\n          rememberMe: false\n        }\n        \n        // 可以在这里跳转到首页或其他页面\n        this.$parent.switchView('home')\n        \n      } catch (error) {\n        console.error('登录错误:', error)\n        alert('登录失败，请稍后再试')\n      } finally {\n        this.isSubmitting = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\ninput:focus {\n  box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);\n}\n\nbutton:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n</style>"],"mappings":"AA+EA,eAAe;EACbA,IAAI,EAAE,WAAW;EACjBC,KAAK,EAAE,CAAC,kBAAkB,EAAE,cAAc,CAAC;EAC3CC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,IAAI,EAAE;QACJC,UAAU,EAAE,EAAE;QACdC,QAAQ,EAAE,EAAE;QACZC,UAAU,EAAE;MACd,CAAC;MACDC,MAAM,EAAE,CAAC,CAAC;MACVC,YAAY,EAAE;IAChB;EACF,CAAC;EACDC,OAAO,EAAE;IACP;IACAC,YAAYA,CAAA,EAAG;MACb,IAAI,CAACH,MAAK,GAAI,CAAC;MACf,IAAII,OAAM,GAAI,IAAG;;MAEjB;MACA,IAAI,CAAC,IAAI,CAACR,IAAI,CAACC,UAAU,CAACQ,IAAI,CAAC,CAAC,EAAE;QAChC,IAAI,CAACL,MAAM,CAACH,UAAS,GAAI,WAAU;QACnCO,OAAM,GAAI,KAAI;MAChB;;MAEA;MACA,IAAI,CAAC,IAAI,CAACR,IAAI,CAACE,QAAQ,EAAE;QACvB,IAAI,CAACE,MAAM,CAACF,QAAO,GAAI,OAAM;QAC7BM,OAAM,GAAI,KAAI;MAChB;MAEA,OAAOA,OAAM;IACf,CAAC;IAED;IACA,MAAME,WAAWA,CAAA,EAAG;MAClB,IAAI,CAAC,IAAI,CAACH,YAAY,CAAC,CAAC,EAAE;QACxB;MACF;MAEA,IAAI,CAACF,YAAW,GAAI,IAAG;MAEvB,IAAI;QACF,MAAMM,QAAO,GAAI,MAAMC,KAAK,CAAC,sCAAsC,EAAE;UACnEC,MAAM,EAAE,MAAM;UACdC,OAAO,EAAE;YACP,cAAc,EAAE;UAClB,CAAC;UACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;YACnBC,QAAQ,EAAE,IAAI,CAAClB,IAAI,CAACC,UAAU;YAAG;YACjCC,QAAQ,EAAE,IAAI,CAACF,IAAI,CAACE;UACtB,CAAC;QACH,CAAC;QAED,MAAMH,IAAG,GAAI,MAAMY,QAAQ,CAACQ,IAAI,CAAC;QAEjC,IAAI,CAACR,QAAQ,CAACS,EAAE,EAAE;UAChB;UACA,IAAIrB,IAAI,CAACsB,KAAK,EAAE;YACdC,KAAK,CAAC,OAAM,GAAIvB,IAAI,CAACsB,KAAK;UAC5B;UACA;QACF;;QAEA;QACA,MAAME,QAAO,GAAI;UACfC,EAAE,EAAEzB,IAAI,CAACyB,EAAE;UACXN,QAAQ,EAAEnB,IAAI,CAACmB,QAAQ;UACvBO,KAAK,EAAE1B,IAAI,CAAC0B,KAAK;UACjBC,OAAO,EAAE3B,IAAI,CAAC2B,OAAO;UACrBC,KAAK,EAAE5B,IAAI,CAAC4B;QACd;;QAEA;QACA,MAAMC,OAAM,GAAI,IAAI,CAAC5B,IAAI,CAACG,UAAS,GAAI0B,YAAW,GAAIC,cAAa;QACnEF,OAAO,CAACG,OAAO,CAAC,MAAM,EAAEf,IAAI,CAACC,SAAS,CAACM,QAAQ,CAAC;;QAEhD;QACA,IAAI,CAACS,KAAK,CAAC,cAAc,EAAET,QAAQ;;QAEnC;QACAD,KAAK,CAAC,OAAO;;QAEb;QACA,IAAI,CAACtB,IAAG,GAAI;UACVC,UAAU,EAAE,EAAE;UACdC,QAAQ,EAAE,EAAE;UACZC,UAAU,EAAE;QACd;;QAEA;QACA,IAAI,CAAC8B,OAAO,CAACC,UAAU,CAAC,MAAM;MAEhC,EAAE,OAAOb,KAAK,EAAE;QACdc,OAAO,CAACd,KAAK,CAAC,OAAO,EAAEA,KAAK;QAC5BC,KAAK,CAAC,YAAY;MACpB,UAAU;QACR,IAAI,CAACjB,YAAW,GAAI,KAAI;MAC1B;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}